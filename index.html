<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rumus Meletup - AxL</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

      <style>
        /* --- 3D LOADER STYLES --- */
        .loader-perspective {
            perspective: 1000px;
            transform-style: preserve-3d;
        }
        .bar-3d {
            transform-style: preserve-3d;
            transform: rotateX(-20deg);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        /* Animasi Naik Turun saat Loading */
        @keyframes float3D {
            0% { transform: translateY(0) rotateX(-20deg); }
            50% { transform: translateY(-40px) rotateX(-20deg) scaleY(1.1); filter: brightness(1.2); }
            100% { transform: translateY(0) rotateX(-20deg); }
        }
        /* Animasi Keluar (Wave Down) */
        @keyframes waveOut {
            0% { transform: translateY(0) rotateX(-20deg); opacity: 1; }
            100% { transform: translateY(200%) rotateX(20deg); opacity: 0; }
        }
        
        .animate-float { animation: float3D 1.5s ease-in-out infinite; }
        .animate-wave-out { animation: waveOut 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards; }

        :root {
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --dark: #0f172a;
            --glass: rgba(30, 41, 59, 0.65);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--dark);
            color: #e2e8f0;
            overflow-x: hidden;
        }

        /* Dynamic Background */
        #bgCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
        }

        /* Premium Glassmorphism */
        .glass {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        .glass:hover {
            border-color: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        /* Utilities */
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .text-gradient {
            background: linear-gradient(135deg, #60a5fa, #c084fc);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Element Card (Periodic Table) */
        .element-card {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.2s;
        }
        .element-card:hover { background: rgba(59, 130, 246, 0.2); transform: scale(1.1); z-index: 10; }
    </style>
</head>

<body class="antialiased">

    <div id="appLoader" class="fixed inset-0 z-[100] bg-[#0f172a] flex flex-col items-center justify-center overflow-hidden">
        
        <div class="loader-perspective flex gap-4 items-end h-32 mb-8" id="barContainer">
            <div class="bar-3d w-8 h-24 bg-gradient-to-t from-blue-900 to-blue-500 rounded-t-lg animate-float" style="animation-delay: 0.0s;"></div>
            <div class="bar-3d w-8 h-32 bg-gradient-to-t from-blue-800 to-blue-400 rounded-t-lg animate-float" style="animation-delay: 0.1s;"></div>
            <div class="bar-3d w-8 h-40 bg-gradient-to-t from-blue-700 to-cyan-400 rounded-t-lg animate-float" style="animation-delay: 0.2s;"></div>
            <div class="bar-3d w-8 h-32 bg-gradient-to-t from-blue-800 to-blue-400 rounded-t-lg animate-float" style="animation-delay: 0.3s;"></div>
            <div class="bar-3d w-8 h-24 bg-gradient-to-t from-blue-900 to-blue-500 rounded-t-lg animate-float" style="animation-delay: 0.4s;"></div>
        </div>

        <h2 class="text-2xl font-black text-white tracking-[0.3em] animate-pulse">AMBA<span class="text-cyan-400">TUBLOW</span></h2>
        <div class="mt-2 text-[10px] text-slate-500 font-mono" id="loaderText">SABAR BOSS.....</div></div>
    </div>
    <canvas id="bgCanvas"></canvas>
    
    <aside class="fixed top-0 left-0 h-full w-20 md:w-64 glass z-50 flex flex-col transition-all duration-300 overflow-hidden group border-r border-white/10">
        <div class="p-6 flex items-center gap-3 justify-center md:justify-start">
            <div class="bg-blue-600 p-2 rounded-lg shrink-0">
                <i data-lucide="atom" class="text-white w-6 h-6"></i>
            </div>
            <span class="font-bold text-xl tracking-tight hidden md:block text-white">Meletup<span class="text-blue-400">3.0</span></span>
        </div>

        <nav class="flex-1 px-4 space-y-2 mt-4">
            <button onclick="switchTab('home')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-white/10 text-slate-300 hover:text-white transition nav-btn active" data-target="home">
                <i data-lucide="home" class="w-5 h-5"></i>
                <span class="hidden md:block font-medium">Home</span>
            </button>

            <button onclick="switchTab('dashboard')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-white/10 text-slate-300 hover:text-white transition nav-btn" data-target="dashboard">
                <i data-lucide="layout-grid" class="w-5 h-5"></i>
                <span class="hidden md:block font-medium">Dashboard</span>
            </button>
            
            <button onclick="switchTab('rumus')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-white/10 text-slate-300 hover:text-white transition nav-btn" data-target="rumus">
                <i data-lucide="book-open" class="w-5 h-5"></i>
                <span class="hidden md:block font-medium">Bank Rumus</span>
            </button>
            <button onclick="switchTab('tools')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-white/10 text-slate-300 hover:text-white transition nav-btn" data-target="tools">
                <i data-lucide="calculator" class="w-5 h-5"></i>
                <span class="hidden md:block font-medium">Tools & Lab</span>
            </button>
            <button onclick="switchTab('periodic')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-white/10 text-slate-300 hover:text-white transition nav-btn" data-target="periodic">
                <i data-lucide="table-2" class="w-5 h-5"></i>
                <span class="hidden md:block font-medium">Tabel Periodik</span>
            </button>
            <button onclick="switchTab('quiz')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-white/10 text-slate-300 hover:text-white transition nav-btn" data-target="quiz">
                <i data-lucide="trophy" class="w-5 h-5"></i>
                <span class="hidden md:block font-medium">Kuis Infinite</span>
            </button>
            
        <div class="px-4 mt-auto mb-2">
            <div class="glass rounded-xl p-2.5 border border-white/10 flex justify-between items-center bg-black/20 shadow-inner">
                
                <div class="flex flex-col items-center gap-0.5 group cursor-help" title="Jaringan">
                    <i data-lucide="wifi" class="w-3 h-3 text-slate-500 group-hover:text-blue-400 transition"></i>
                    <span class="text-[9px] font-mono font-bold text-slate-600 group-hover:text-blue-300 transition uppercase" id="netStatus">WIFI</span>
                </div>

                <div class="w-px h-6 bg-white/5"></div>

                <div class="flex flex-col items-center">
                    <span class="text-xs font-bold text-white font-mono tracking-widest" id="realTime">00:00</span>
                    <span class="text-[8px] text-slate-500 uppercase tracking-wider">System</span>
                </div>

                <div class="w-px h-6 bg-white/5"></div>

                <div class="flex flex-col items-center gap-0.5 group cursor-help" title="Baterai">
                    <div class="relative">
                        <i data-lucide="battery" class="w-3 h-3 text-slate-500 group-hover:text-green-400 transition" id="batIcon"></i>
                        <div id="batBolt" class="absolute -top-1 -right-1 hidden text-yellow-400"><i data-lucide="zap" class="w-2 h-2 fill-current"></i></div>
                    </div>
                    <span class="text-[9px] font-mono font-bold text-slate-600 group-hover:text-green-400 transition" id="batLevel">--%</span>
                </div>

            </div>
        </div>
        </nav>

        <div class="p-4 border-t border-white/10 bg-black/20">
            <div class="flex justify-between items-end mb-1">
                <div>
                    <div class="text-[10px] text-slate-400 font-bold tracking-wider">RANK</div>
                    <div class="text-sm font-bold text-yellow-400" id="rankName">Novice</div>
                </div>
                <div class="text-right">
                    <div class="text-[10px] text-slate-400">LVL <span class="text-white text-lg" id="userLevel">1</span></div>
                </div>
            </div>
            <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden relative">
                <div id="xpBar" class="h-full bg-gradient-to-r from-blue-500 to-cyan-400 transition-all duration-500" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-[9px] text-slate-500 mt-1 font-mono">
                <span id="currentXP">0</span>
                <span id="nextXP">100 XP</span>
            </div>
            
            <button onclick="toggleAchievements()" class="w-full mt-3 py-1.5 rounded border border-yellow-500/30 text-yellow-500 text-xs font-bold hover:bg-yellow-500/10 transition flex items-center justify-center gap-2">
                <i data-lucide="medal" class="w-3 h-3"></i> Achievements
            </button>
        </div>
    </aside>

    <main class="ml-20 md:ml-64 p-6 md:p-10 min-h-screen">
        
        <header class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-3xl font-bold text-white" id="pageTitle">Home</h1>
                <p class="text-slate-400 text-sm">Selamat datang di Rumus Meletup 1.0.</p>
            </div>

            <div class="relative w-64 hidden sm:block">
                <input type="text" id="globalSearch" placeholder="Cari rumus (Ctrl+K)..." 
                    class="w-full bg-slate-900/80 border border-slate-700 rounded-full py-2 pl-10 pr-4 text-sm focus:outline-none focus:border-blue-500 transition">
                <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-slate-500"></i>
            </div>
        </header>

<div id="view-home" class="view-section animate-fade-in">
    <div class="glass p-8 rounded-3xl border-t-4 border-blue-500 mb-8 text-center relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-blue-600/10 to-transparent pointer-events-none"></div>
        <h2 class="text-4xl md:text-5xl font-black text-white mb-4 tracking-tight">RUMUS <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">NAK MELETUP </span></h2>
        <p class="text-slate-300 max-w-2xl mx-auto text-lg mb-6">
            Kumpulan Rumus - Rumus Untuk Pelajar Indonesia cEmas
                    </p>
        <button onclick="switchTab('dashboard')" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-blue-500/30 transition transform hover:scale-105 flex items-center gap-2 mx-auto">
            <i data-lucide="rocket"></i> Mulai Belajar
        </button>
    </div>

    <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2"><i data-lucide="map"></i> Daftar Fitur</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glass p-6 rounded-2xl hover:bg-white/5 transition cursor-pointer" onclick="switchTab('dashboard')">
            <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center mb-4 text-blue-400">
                <i data-lucide="layout-grid" class="w-6 h-6"></i>
            </div>
            <h4 class="font-bold text-white text-lg mb-2">Dashboard Utama</h4>
            <p class="text-sm text-slate-400">Pusat komando berisi Kalkulator Ilmiah, Timer Fokus (Pomodoro), To-Do List, dan Coretan rumus cepat.</p>
        </div>

        <div class="glass p-6 rounded-2xl hover:bg-white/5 transition cursor-pointer" onclick="switchTab('rumus')">
            <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center mb-4 text-purple-400">
                <i data-lucide="book-open" class="w-6 h-6"></i>
            </div>
            <h4 class="font-bold text-white text-lg mb-2">Bank Rumus</h4>
            <p class="text-sm text-slate-400">Akses instan ke ratusan rumus Matematika, Fisika, dan Kimia lengkap dengan render LaTeX yang indah.</p>
        </div>

        <div class="glass p-6 rounded-2xl hover:bg-white/5 transition cursor-pointer" onclick="switchTab('tools')">
            <div class="w-12 h-12 bg-pink-500/20 rounded-lg flex items-center justify-center mb-4 text-pink-400">
                <i data-lucide="calculator" class="w-6 h-6"></i>
            </div>
            <h4 class="font-bold text-white text-lg mb-2">Laboratorium Tools</h4>
            <p class="text-sm text-slate-400">Simulasi interaktif seperti Gerak Parabola, Bandul, Regresi Linear, dan Konverter Satuan.</p>
        </div>

        <div class="glass p-6 rounded-2xl hover:bg-white/5 transition cursor-pointer" onclick="switchTab('periodic')">
            <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center mb-4 text-green-400">
                <i data-lucide="table-2" class="w-6 h-6"></i>
            </div>
            <h4 class="font-bold text-white text-lg mb-2">Tabel Periodik</h4>
            <p class="text-sm text-slate-400">Peta lengkap unsur kimia dengan detail massa atom, golongan, dan kategori elemen.</p>
        </div>

        <div class="glass p-6 rounded-2xl hover:bg-white/5 transition cursor-pointer" onclick="switchTab('quiz')">
            <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center mb-4 text-yellow-400">
                <i data-lucide="trophy" class="w-6 h-6"></i>
            </div>
            <h4 class="font-bold text-white text-lg mb-2">Kuis & Rank</h4>
            <p class="text-sm text-slate-400">Sistem gamifikasi (XP & Level) untuk menguji pemahamanmu. Raih achievement tertinggi!</p>
        </div>

        <div class="glass p-6 rounded-2xl hover:bg-white/5 transition cursor-help">
            <div class="w-12 h-12 bg-slate-500/20 rounded-lg flex items-center justify-center mb-4 text-slate-400">
                <i data-lucide="bot" class="w-6 h-6"></i>
            </div>
            <h4 class="font-bold text-white text-lg mb-2">AI Assistant</h4>
            <p class="text-sm text-slate-400">Klik tombol biru di pojok kanan bawah untuk bertanya rumus secara instan kepada AI Bot.</p>
        </div>
    </div>

    <footer class="mt-16 border-t border-white/10 pt-8 pb-4 text-center relative">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-[#0f172a] px-4 text-xs text-slate-500 font-mono border border-white/10 rounded-full">Credit</div>
        
        <p class="text-slate-300 text-sm mb-2">
            Dibuat dengan ðŸ’¦ oleh <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400 font-bold">Junn</span>
        </p>
        
        <div class="flex justify-center gap-3 md:gap-6 text-[10px] text-slate-500 font-mono uppercase tracking-widest mt-4 opacity-70">
            <span class="hover:text-blue-400 transition">Tailwind CSS</span>
            <span>â€¢</span>
            <span class="hover:text-green-400 transition">MathJax</span>
            <span>â€¢</span>
            <span class="hover:text-yellow-400 transition">Lucide Icons</span>
            <span>â€¢</span>
            <span class="hover:text-pink-400 transition">Plotly.js</span>
        </div>
        
        <p class="text-[9px] text-slate-700 mt-4">Rumus Meletup v1.0(Stable Build) &copy; 2030</p>
    </footer>

</div>

<div id="view-dashboard" class="view-section hidden animate-fade-in">
...
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        
        <div class="glass p-6 rounded-2xl lg:col-span-2 row-span-2 flex flex-col">
            <div class="flex justify-between mb-4">
                <h3 class="font-bold text-blue-400 flex items-center gap-2"><i data-lucide="cpu"></i> Scientific Calc</h3>
                <div class="text-right font-mono text-2xl text-white overflow-hidden" id="calcDisplay">0</div>
            </div>
            <div class="grid grid-cols-6 gap-2 flex-1">
                <button onclick="calcIn('sin(')" class="p-2 rounded bg-slate-700/50 hover:bg-blue-600/50 text-xs text-slate-300">sin</button>
                <button onclick="calcIn('cos(')" class="p-2 rounded bg-slate-700/50 hover:bg-blue-600/50 text-xs text-slate-300">cos</button>
                <button onclick="calcIn('tan(')" class="p-2 rounded bg-slate-700/50 hover:bg-blue-600/50 text-xs text-slate-300">tan</button>
                <button onclick="calcClear()" class="p-2 rounded bg-red-500/20 text-red-400 hover:bg-red-500/40 col-span-2 font-bold">AC</button>
                <button onclick="calcDel()" class="p-2 rounded bg-yellow-500/20 text-yellow-400">âŒ«</button>
                
                <button onclick="calcIn('log(')" class="p-2 rounded bg-slate-700/50 text-xs text-slate-300">log</button>
                <button onclick="calcIn('sqrt(')" class="p-2 rounded bg-slate-700/50 text-xs text-slate-300">âˆš</button>
                <button onclick="calcIn('^')" class="p-2 rounded bg-slate-700/50 text-xs text-slate-300">^</button>
                <button onclick="calcIn('(')" class="p-2 rounded bg-slate-700/50 text-xs text-slate-300">(</button>
                <button onclick="calcIn(')')" class="p-2 rounded bg-slate-700/50 text-xs text-slate-300">)</button>
                <button onclick="calcIn('/')" class="p-2 rounded bg-slate-700 text-blue-300 text-lg">Ã·</button>

                <button onclick="calcIn('7')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">7</button>
                <button onclick="calcIn('8')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">8</button>
                <button onclick="calcIn('9')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">9</button>
                <button onclick="calcIn('*')" class="p-3 rounded bg-slate-700 text-blue-300 text-lg col-span-3">Ã—</button>
                
                <button onclick="calcIn('4')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">4</button>
                <button onclick="calcIn('5')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">5</button>
                <button onclick="calcIn('6')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">6</button>
                <button onclick="calcIn('-')" class="p-3 rounded bg-slate-700 text-blue-300 text-lg col-span-3">-</button>

                <button onclick="calcIn('1')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">1</button>
                <button onclick="calcIn('2')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">2</button>
                <button onclick="calcIn('3')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">3</button>
                <button onclick="calcIn('+')" class="p-3 rounded bg-slate-700 text-blue-300 text-lg col-span-3">+</button>

                <button onclick="calcIn('0')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold col-span-2">0</button>
                <button onclick="calcIn('.')" class="p-3 rounded bg-slate-800 hover:bg-slate-700 text-white font-bold">.</button>
                <button onclick="calcResult()" class="p-3 rounded bg-blue-600 hover:bg-blue-500 text-white font-bold col-span-3">=</button>
            </div>
        </div>

        <div class="glass p-6 rounded-2xl border-t-4 border-red-500 flex flex-col items-center justify-center relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-10"><i data-lucide="timer" class="w-16 h-16 text-red-500"></i></div>
            <h3 class="font-bold text-white mb-2 self-start">Focus Timer</h3>
            <div class="text-5xl font-mono font-bold text-white mb-4 tracking-wider" id="timerDisplay">25:00</div>
            <div class="flex gap-2 w-full">
                <button onclick="toggleTimer()" id="timerBtn" class="flex-1 bg-red-600 hover:bg-red-500 py-2 rounded-lg text-white font-bold transition">Start</button>
                <button onclick="resetTimer()" class="px-3 bg-slate-700 hover:bg-slate-600 rounded-lg text-white"><i data-lucide="rotate-ccw" class="w-4 h-4"></i></button>
            </div>
            <p class="text-xs text-slate-400 mt-3 text-center">"Teknik Pomodoro: Fokus 25 menit, istirahat 5 menit."</p>
        </div>

        <div class="glass p-6 rounded-2xl border-t-4 border-yellow-500 flex flex-col">
            <h3 class="font-bold text-white mb-3 flex justify-between items-center">
                <span>Target Belajar</span>
                <span class="text-xs bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded" id="todoCount">0 Selesai</span>
            </h3>
            <div class="flex gap-2 mb-3">
                <input type="text" id="todoInput" placeholder="Tugas baru..." class="w-full bg-slate-800/50 border border-slate-600 rounded px-2 py-1 text-sm text-white outline-none focus:border-yellow-500">
                <button onclick="addTodo()" class="bg-yellow-600 hover:bg-yellow-500 px-3 rounded text-white font-bold">+</button>
            </div>
            <ul id="todoList" class="flex-1 overflow-y-auto max-h-[150px] space-y-2 text-sm pr-1 custom-scrollbar">
                <li class="text-slate-500 text-center italic text-xs mt-4">Belum ada tugas.</li>
            </ul>
        </div>

        <div class="glass p-6 rounded-2xl border-t-4 border-green-500">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-white">Coretan</h3>
                <span class="text-[10px] text-green-400 animate-pulse" id="saveStatus">Auto-saved</span>
            </div>
            <textarea id="scratchpad" oninput="savePad()" class="w-full h-32 bg-yellow-100/10 text-yellow-100 p-3 rounded-lg text-sm font-mono outline-none resize-none border border-white/10 focus:bg-yellow-100/20 transition" placeholder="Tulis rumus atau catatan penting di sini..."></textarea>
        </div>

        <div class="glass p-6 rounded-2xl border-t-4 border-purple-500">
            <h3 class="font-bold text-white mb-3">Statistik Cepat</h3>
            <input id="statsInput" class="w-full bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm mb-2 text-white font-mono" placeholder="Data: 2, 5, 8...">
            <button onclick="runStats()" class="w-full bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 py-1.5 rounded text-xs font-bold border border-purple-500/50 mb-2">Hitung</button>
            <div id="statsOutput" class="grid grid-cols-2 gap-2 text-xs text-slate-300 font-mono">
                <div>Mean: <span class="text-white">-</span></div>
                <div>SD: <span class="text-white">-</span></div>
            </div>
        </div>

        </div>

    </div>
</div>

        <div id="view-rumus" class="view-section hidden animate-fade-in">
            <div class="flex gap-4 mb-6 overflow-x-auto pb-2">
                <button onclick="filterRumus('all')" class="px-4 py-2 rounded-full bg-blue-600 text-white text-sm font-medium whitespace-nowrap">Semua</button>
                <button onclick="filterRumus('Matematika')" class="px-4 py-2 rounded-full glass hover:bg-white/10 text-slate-300 text-sm font-medium whitespace-nowrap">Matematika</button>
                <button onclick="filterRumus('Fisika')" class="px-4 py-2 rounded-full glass hover:bg-white/10 text-slate-300 text-sm font-medium whitespace-nowrap">Fisika</button>
                <button onclick="filterRumus('Kimia')" class="px-4 py-2 rounded-full glass hover:bg-white/10 text-slate-300 text-sm font-medium whitespace-nowrap">Kimia</button>
            </div>
            
            <div id="rumusContainer" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                </div>
        </div>

        <div id="view-tools" class="view-section hidden animate-fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-bold text-pink-400 mb-4">Simulasi Gerak Parabola</h3>
                    <div class="flex gap-2 mb-4">
                        <input id="sim_v0" type="number" value="50" class="bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm w-full" placeholder="Vo (m/s)">
                        <input id="sim_ang" type="number" value="45" class="bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm w-full" placeholder="Sudut (Â°)">
                        <button onclick="runProjectile()" class="bg-pink-600 hover:bg-pink-500 px-4 rounded text-white"><i data-lucide="play"></i></button>
                    </div>
                    <div id="projectilePlot" class="w-full h-64 bg-slate-900/50 rounded-lg"></div>
                </div>

<div class="glass p-6 rounded-2xl border-t-4 border-blue-500">
    <h3 class="font-bold text-blue-400 mb-4">Regresi Linear</h3>
    <div class="space-y-2 mb-4">
        <input id="reg_x" type="text" value="1, 2, 3, 4, 5" class="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm" placeholder="Data X (pisahkan koma)">
        <input id="reg_y" type="text" value="2, 4, 5, 4, 5" class="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm" placeholder="Data Y (pisahkan koma)">
        <button onclick="runRegression()" class="w-full bg-blue-600 hover:bg-blue-500 py-2 rounded font-bold text-white text-sm">Plot Grafik</button>
    </div>
    <div id="regPlot" class="w-full h-48 bg-slate-900/50 rounded-lg"></div>
    <div id="regEq" class="text-center text-xs font-mono text-blue-300 mt-2 min-h-[1rem]"></div>
</div>

<div class="glass p-6 rounded-2xl border-t-4 border-yellow-500">
    <h3 class="font-bold text-yellow-400 mb-2">Simulasi Bandul</h3>
    <div class="flex gap-2 mb-3">
        <div class="flex-1">
            <label class="text-[10px] text-slate-400">Panjang Tali (L)</label>
            <input id="pen_l" type="range" min="50" max="200" value="150" class="w-full accent-yellow-500">
        </div>
        <div class="flex-1">
            <label class="text-[10px] text-slate-400">Gravitasi (g)</label>
            <input id="pen_g" type="range" min="1" max="20" value="9.8" class="w-full accent-yellow-500">
        </div>
    </div>
    <canvas id="pendulumCanvas" width="300" height="200" class="w-full bg-slate-900/50 rounded-lg border border-slate-700"></canvas>
    <div class="flex justify-between mt-2">
        <button onclick="startPendulum()" class="bg-yellow-600 hover:bg-yellow-500 px-3 py-1 rounded text-xs text-white font-bold">Start/Reset</button>
        <span id="pen_period" class="text-xs font-mono text-yellow-300 pt-1">T: - s</span>
    </div>
</div>

<div class="glass p-6 rounded-2xl border-t-4 border-teal-400">
    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-teal-400">Grafik Lissajous</h3>
        <button onclick="updateLissajous()" class="text-xs bg-teal-500/20 text-teal-300 px-2 py-1 rounded hover:bg-teal-500/40 transition">Refresh</button>
    </div>
    
    <div class="grid grid-cols-3 gap-4 mb-2">
        <div>
            <label class="text-[10px] text-slate-400 block mb-1">Frekuensi X (a)</label>
            <input id="lis_a" type="range" min="1" max="10" value="3" step="1" oninput="updateLissajous()" class="w-full accent-teal-500 h-1 bg-slate-700 rounded appearance-none">
            <div class="text-center text-xs font-mono text-white" id="val_a">3</div>
        </div>
        <div>
            <label class="text-[10px] text-slate-400 block mb-1">Frekuensi Y (b)</label>
            <input id="lis_b" type="range" min="1" max="10" value="2" step="1" oninput="updateLissajous()" class="w-full accent-teal-500 h-1 bg-slate-700 rounded appearance-none">
             <div class="text-center text-xs font-mono text-white" id="val_b">2</div>
        </div>
        <div>
            <label class="text-[10px] text-slate-400 block mb-1">Fase (Î´)</label>
            <input id="lis_d" type="range" min="0" max="6.28" value="1.57" step="0.1" oninput="updateLissajous()" class="w-full accent-teal-500 h-1 bg-slate-700 rounded appearance-none">
             <div class="text-center text-xs font-mono text-white" id="val_d">Ï€/2</div>
        </div>
    </div>
    
    <div id="lissajousPlot" class="w-full h-48 bg-slate-900/50 rounded-lg border border-slate-700/50"></div>
    <p class="text-[10px] text-slate-500 text-center mt-2">Rumus: x = sin(at + Î´), y = sin(bt)</p>
</div>

                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-bold text-cyan-400 mb-4">Kalkulator Energi & Usaha</h3>
                    <select id="energyType" onchange="renderEnergyInputs()" class="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white mb-4">
                        <option value="Ek">Energi Kinetik (Ek)</option>
                        <option value="Ep">Energi Potensial (Ep)</option>
                        <option value="W">Usaha (W)</option>
                    </select>
                    <div id="energyInputs" class="space-y-2 mb-4"></div>
                    <button onclick="calcEnergy()" class="w-full bg-cyan-600 hover:bg-cyan-500 py-2 rounded font-bold text-white">Hitung</button>
                    <div id="energyResult" class="mt-4 text-right text-2xl font-mono text-cyan-300 font-bold">0 J</div>                               
                </div>               
           
               
<div class="glass p-6 rounded-2xl">
    <h3 class="font-bold text-green-400 mb-4">Konverter Satuan</h3>
    <div class="space-y-3">
        <div class="grid grid-cols-2 gap-2">
            <select id="conv_cat" onchange="updateUnits()" class="bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm">
                <option value="len">Panjang</option>
                <option value="mass">Massa</option>
                <option value="temp">Suhu</option>
            </select>
            <input id="conv_val" type="number" placeholder="Nilai" class="bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm">
        </div>
        <div class="grid grid-cols-[1fr_auto_1fr] gap-2 items-center">
            <select id="conv_from" class="bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm"></select>
            <i data-lucide="arrow-right" class="text-slate-500 w-4 h-4"></i>
            <select id="conv_to" class="bg-slate-800 border border-slate-600 rounded p-2 text-white text-sm"></select>
        </div>
        <button onclick="runConvert()" class="w-full bg-green-600 hover:bg-green-500 py-2 rounded font-bold text-white">Konversi</button>
        <div id="conv_res" class="text-center text-xl font-mono text-green-300 font-bold mt-2">-</div>
    </div>
</div>

           
                     
            </div>                                        
        </div>

        <div id="view-periodic" class="view-section hidden animate-fade-in">
            <div class="flex flex-wrap gap-3 mb-6 px-2 justify-center md:justify-start">
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span><span class="text-[10px] text-slate-400">Alkali</span></div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-orange-400"></span><span class="text-[10px] text-slate-400">Alkali Tanah</span></div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-blue-500"></span><span class="text-[10px] text-slate-400">Transisi</span></div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500"></span><span class="text-[10px] text-slate-400">Non-Logam</span></div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-purple-500"></span><span class="text-[10px] text-slate-400">Gas Mulia</span></div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-cyan-500"></span><span class="text-[10px] text-slate-400">Halogen</span></div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-pink-500"></span><span class="text-[10px] text-slate-400">Metaloid</span></div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-slate-600"></span><span class="text-[10px] text-slate-400">Lainnya</span></div>
            </div>

            <div class="overflow-x-auto pb-4">
                <div id="periodicTable" class="grid grid-cols-18 gap-1.5 min-w-[800px]" style="grid-template-columns: repeat(18, minmax(40px, 1fr));">
                    </div>
            </div>
            <div id="elementDetail" class="mt-6 glass p-6 rounded-2xl hidden">
                <h3 class="text-2xl font-bold text-white mb-2" id="elName">Hydrogen</h3>
                <p class="text-slate-400" id="elDesc">Detail element...</p>
            </div>
        </div>

                <div id="view-quiz" class="view-section hidden animate-fade-in">
            <div class="max-w-2xl mx-auto text-center">
                <div class="glass p-8 rounded-2xl relative overflow-hidden">
                    
                    <div class="absolute top-0 left-0 w-full h-2 bg-slate-700">
                        <div id="quizTimerBar" class="h-full bg-yellow-400 transition-all duration-1000 ease-linear" style="width: 100%"></div>
                    </div>

                    <div class="mb-4 mt-4 flex justify-between items-center">
                        <span class="bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs font-bold">MODE: SURVIVAL</span>
                        
                        <button onclick="useLifeline()" id="btnLifeline" class="bg-purple-600/20 hover:bg-purple-600 text-purple-300 hover:text-white px-3 py-1 rounded-full text-xs font-bold border border-purple-500 transition flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i data-lucide="life-buoy" class="w-3 h-3"></i> 50:50
                        </button>
                    </div>

                    <h2 class="text-2xl font-bold text-white mb-6 min-h-[4rem] flex items-center justify-center" id="quizQuestion">Siap untuk mulai?</h2>
                    
                    <div id="quizOptions" class="grid grid-cols-1 gap-3 mb-6">
                        <button onclick="startQuiz()" class="p-4 rounded-xl bg-blue-600 hover:bg-blue-500 text-white font-bold transition shadow-[0_0_20px_rgba(37,99,235,0.5)] animate-pulse">Mulai Tantangan</button>
                    </div>
                    
                    <div class="text-slate-400 text-sm flex justify-between px-4">
                        <span>Sisa Waktu: <span id="timeText" class="text-white font-mono">--</span></span>
                        <span>Skor: <span id="quizScore" class="text-yellow-400 font-bold">0</span></span>
                    </div>
                </div>
            </div>
        </div>
       

    </main>

    <button onclick="toggleBot()" class="fixed bottom-6 right-6 bg-blue-600 p-4 rounded-full shadow-lg hover:scale-110 transition z-50">
        <i data-lucide="message-circle" class="text-white w-6 h-6"></i>
    </button>

    <div id="achModal" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center backdrop-blur-sm animate-fade-in">
        <div class="glass p-6 rounded-2xl w-full max-w-lg m-4 border border-yellow-500/30 relative">
            <button onclick="toggleAchievements()" class="absolute top-4 right-4 text-slate-400 hover:text-white"><i data-lucide="x"></i></button>
            
            <div class="flex items-center gap-3 mb-6">
                <div class="bg-yellow-500/20 p-3 rounded-full">
                    <i data-lucide="trophy" class="w-8 h-8 text-yellow-400"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-white">Penghargaan</h2>
                    <p class="text-slate-400 text-sm">Koleksi medali perjalanan belajarmu.</p>
                </div>
            </div>

            <div id="achList" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                </div>
        </div>
    </div>

    <div id="quizResultModal" class="fixed inset-0 bg-black/90 z-[70] hidden flex items-center justify-center backdrop-blur-md transition-opacity duration-300">
        <div class="glass p-8 rounded-3xl max-w-sm w-full text-center border-2 relative transform transition-all duration-300 scale-95" id="quizResultCard">
            
            <div id="qResIcon" class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-[0_0_30px_rgba(255,255,255,0.2)] animate-bounce">
                </div>

            <h2 id="qResTitle" class="text-3xl font-black text-white mb-2 uppercase tracking-wider">JAWABAN BENAR!</h2>
            <p id="qResDesc" class="text-slate-300 text-sm mb-6">Kamu mendapatkan +50 XP</p>

            <div id="qResStats" class="grid grid-cols-2 gap-3 mb-6 hidden">
                <div class="bg-white/5 p-2 rounded-xl border border-white/10">
                    <div class="text-[10px] text-slate-400">STREAK</div>
                    <div class="text-xl font-bold text-yellow-400" id="qResStreak">0</div>
                </div>
                <div class="bg-white/5 p-2 rounded-xl border border-white/10">
                    <div class="text-[10px] text-slate-400">TOTAL SKOR</div>
                    <div class="text-xl font-bold text-blue-400" id="qResScore">0</div>
                </div>
            </div>

            <button onclick="closeQuizResult()" id="qResBtn" class="w-full py-3 rounded-xl font-bold text-white shadow-lg transition transform hover:scale-105">
                Lanjut
            </button>
        </div>
    </div>


    <div id="botModal" class="fixed bottom-24 right-6 w-80 glass rounded-2xl p-4 hidden z-50 flex flex-col h-96 border border-blue-500/30">
        <div class="flex justify-between items-center mb-4 border-b border-white/10 pb-2">
            <span class="font-bold text-blue-400">AI Tutor</span>
            <button onclick="toggleBot()" class="text-slate-400 hover:text-white"><i data-lucide="x" class="w-4 h-4"></i></button>
        </div>
        <div id="botChat" class="flex-1 overflow-y-auto space-y-2 mb-4 text-sm">
            <div class="bg-slate-700/50 p-2 rounded-lg self-start rounded-tl-none">Halo! Tanya rumus apa saja.</div>
        </div>
        <div class="flex gap-2">
            <input type="text" id="botInput" class="w-full bg-slate-800 rounded p-2 text-xs text-white" placeholder="Ketik...">
            <button onclick="sendBot()" class="bg-blue-600 p-2 rounded text-white"><i data-lucide="send" class="w-4 h-4"></i></button>
        </div>
    </div>

    <script>
        // --- 1. CORE DATABASE (THE "5000 LINES" FOUNDATION) ---
        // Struktur data ini memungkinkan kita menambah ribuan rumus tanpa coding HTML.
        // Cukup copy-paste objek baru ke dalam array ini.

const FORMULA_DB = [
    // --- MATEMATIKA (ALJABAR & GEOMETRI) ---
    { id: "m1", cat: "Matematika", title: "Rumus ABC", latex: "x_{1,2} = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}", desc: "Mencari akar-akar persamaan kuadrat axÂ² + bx + c = 0." },
    { id: "m2", cat: "Matematika", title: "Luas Lingkaran", latex: "L = \\pi r^2", desc: "Menghitung luas daerah lingkaran." },
    { id: "m3", cat: "Matematika", title: "Keliling Lingkaran", latex: "K = 2 \\pi r", desc: "Menghitung panjang keliling lingkaran." },
    { id: "m4", cat: "Matematika", title: "Volume Bola", latex: "V = \\frac{4}{3} \\pi r^3", desc: "Menghitung isi volume bola pejal." },
    { id: "m5", cat: "Matematika", title: "Volume Kerucut", latex: "V = \\frac{1}{3} \\pi r^2 t", desc: "Menghitung volume bangun ruang kerucut." },
    { id: "m6", cat: "Matematika", title: "Pythagoras", latex: "c^2 = a^2 + b^2", desc: "Mencari sisi miring segitiga siku-siku." },
    { id: "m7", cat: "Matematika", title: "Logaritma Dasar", latex: "^a\\log b = c \\iff a^c = b", desc: "Definisi dasar logaritma." },
    { id: "m8", cat: "Matematika", title: "Barisan Aritmatika (Un)", latex: "U_n = a + (n-1)b", desc: "Mencari suku ke-n barisan aritmatika." },
    { id: "m9", cat: "Matematika", title: "Deret Aritmatika (Sn)", latex: "S_n = \\frac{n}{2}(2a + (n-1)b)", desc: "Jumlah n suku pertama barisan aritmatika." },
    { id: "m10", cat: "Matematika", title: "Barisan Geometri (Un)", latex: "U_n = ar^{n-1}", desc: "Mencari suku ke-n barisan geometri." },
    { id: "m11", cat: "Matematika", title: "Deret Geometri Tak Hingga", latex: "S_\\infty = \\frac{a}{1-r}", desc: "Jumlah deret geometri konvergen." },
        { id: "m12", cat: "Matematika", title: "Kombinasi", latex: "C(n,r) = \\frac{n!}{r!(n-r)!}", desc: "Cara memilih objek tanpa memperhatikan urutan." },
    { id: "m13", cat: "Matematika", title: "Permutasi", latex: "P(n,r) = \\frac{n!}{(n-r)!}", desc: "Cara menyusun objek dengan memperhatikan urutan." },
    { id: "m14", cat: "Matematika", title: "Volume Balok", latex: "V = p \\cdot l \\cdot t", desc: "Menghitung volume bangun ruang balok." },
    { id: "m15", cat: "Matematika", title: "Luas Permukaan Kubus", latex: "L = 6s^2", desc: "Total luas seluruh sisi kubus." },
    { id: "m16", cat: "Matematika", title: "Determinan Matriks (2x2)", latex: "|A| = ad - bc", desc: "Nilai determinan matriks ordo 2x2." },
    { id: "m17", cat: "Matematika", title: "Invers Matriks (2x2)", latex: "A^{-1} = \\frac{1}{|A|} \\begin{pmatrix} d & -b \\\\ -c & a \\end{pmatrix}", desc: "Kebalikan dari matriks persegi." },
    { id: "m18", cat: "Matematika", title: "Vektor (Resultan)", latex: "R = \\sqrt{F_1^2 + F_2^2 + 2F_1F_2 \\cos \\alpha}", desc: "Menghitung panjang resultan dua vektor." },
    { id: "m19", cat: "Matematika", title: "Persamaan Lingkaran", latex: "(x-a)^2 + (y-b)^2 = r^2", desc: "Lingkaran dengan pusat (a,b) dan jari-jari r." },
    { id: "m20", cat: "Matematika", title: "Trigonometri (Sudut Rangkap)", latex: "\\sin 2x = 2 \\sin x \\cos x", desc: "Identitas sinus untuk sudut ganda." },
    { id: "m21", cat: "Matematika", title: "Trigonometri (Jumlah Sudut)", latex: "\\sin(A+B) = \\sin A \\cos B + \\cos A \\sin B", desc: "Sinus dari penjumlahan dua sudut." },
    { id: "m22", cat: "Matematika", title: "Simpangan Baku (Populasi)", latex: "\\sigma = \\sqrt{\\frac{\\sum(x_i - \\mu)^2}{N}}", desc: "Ukuran sebaran data statistik." },

    
    // --- MATEMATIKA (KALKULUS & TRIGONO) ---
    { id: "mk1", cat: "Matematika", title: "Turunan Dasar", latex: "f(x)=ax^n \\rightarrow f'(x)=anx^{n-1}", desc: "Rumus dasar diferensial pangkat." },
    { id: "mk2", cat: "Matematika", title: "Integral Tak Tentu", latex: "\\int x^n dx = \\frac{1}{n+1}x^{n+1} + C", desc: "Rumus dasar integral pangkat (n â‰  -1)." },
    { id: "mk3", cat: "Matematika", title: "Identitas Trigonometri", latex: "\\sin^2 x + \\cos^2 x = 1", desc: "Identitas Pythagoras trigonometri." },
    { id: "mk4", cat: "Matematika", title: "Aturan Sinus", latex: "\\frac{a}{\\sin A} = \\frac{b}{\\sin B} = \\frac{c}{\\sin C}", desc: "Perbandingan sisi dan sudut segitiga sembarang." },
    { id: "mk5", cat: "Matematika", title: "Aturan Cosinus", latex: "a^2 = b^2 + c^2 - 2bc \\cos A", desc: "Mencari panjang sisi segitiga sembarang." },
    { id: "mk6", cat: "Matematika", title: "Limit Tak Hingga", latex: "\\lim_{x \\to \\infty} \\frac{ax^m + ...}{bx^n + ...} = \\frac{a}{b}", desc: "Limit tak hingga jika pangkat tertinggi sama (m=n)." },

    // --- FISIKA (MEKANIKA) ---
    { id: "f1", cat: "Fisika", title: "Hukum Newton II", latex: "\\Sigma F = m \\cdot a", desc: "Resultan gaya berbanding lurus dengan massa dan percepatan." },
    { id: "f2", cat: "Fisika", title: "GLBB (Jarak)", latex: "s = v_0 t + \\frac{1}{2} a t^2", desc: "Jarak tempuh gerak lurus berubah beraturan." },
    { id: "f3", cat: "Fisika", title: "GLBB (Kecepatan)", latex: "v_t^2 = v_0^2 + 2as", desc: "Hubungan kecepatan, percepatan, dan jarak tanpa waktu." },
    { id: "f4", cat: "Fisika", title: "Gaya Gesek", latex: "f_k = \\mu_k \\cdot N", desc: "Gaya gesek kinetis benda bergerak." },
    { id: "f5", cat: "Fisika", title: "Usaha (Work)", latex: "W = F \\cdot s \\cos \\theta", desc: "Energi yang disalurkan gaya ke benda." },
    { id: "f6", cat: "Fisika", title: "Energi Kinetik", latex: "E_k = \\frac{1}{2}mv^2", desc: "Energi yang dimiliki benda karena geraknya." },
    { id: "f7", cat: "Fisika", title: "Energi Potensial", latex: "E_p = mgh", desc: "Energi benda karena ketinggiannya." },
    { id: "f8", cat: "Fisika", title: "Momentum", latex: "p = m \\cdot v", desc: "Ukuran kesukaran memberhentikan benda." },
    { id: "f9", cat: "Fisika", title: "Impuls", latex: "I = F \\cdot \\Delta t = \\Delta p", desc: "Perubahan momentum." },
    { id: "f10", cat: "Fisika", title: "Gaya Sentripetal", latex: "F_s = m \\frac{v^2}{r}", desc: "Gaya yang menarik benda ke pusat lingkaran." },
    { id: "f11", cat: "Fisika", title: "Hukum Hooke (Pegas)", latex: "F = -k \\Delta x", desc: "Gaya pemulih pada pegas elastis." },
    { id: "f12", cat: "Fisika", title: "Periode Bandul", latex: "T = 2\\pi \\sqrt{\\frac{L}{g}}", desc: "Waktu satu getaran bandul sederhana." },
    { id: "f13", cat: "Fisika", title: "Efek Doppler", latex: "f_p = f_s \\frac{v \\pm v_p}{v \\pm v_s}", desc: "Perubahan frekuensi bunyi akibat gerak." },
    { id: "f14", cat: "Fisika", title: "Cermin/Lensa", latex: "\\frac{1}{f} = \\frac{1}{s} + \\frac{1}{s'}", desc: "Hubungan fokus, jarak benda, dan bayangan." },
    { id: "f15", cat: "Fisika", title: "Perbesaran Bayangan", latex: "M = |\\frac{s'}{s}| = |\\frac{h'}{h}|", desc: "Rasio ukuran bayangan terhadap benda asli." },
    { id: "f16", cat: "Fisika", title: "Hukum Snellius (Bias)", latex: "n_1 \\sin i = n_2 \\sin r", desc: "Pembiasan cahaya antar dua medium." },
    { id: "f17", cat: "Fisika", title: "Energi Foton", latex: "E = h \\cdot f", desc: "Energi partikel cahaya (kuantum)." },
    { id: "f18", cat: "Fisika", title: "Hukum Bernoulli", latex: "P + \\rho gh + \\frac{1}{2}\\rho v^2 = C", desc: "Kekekalan energi pada fluida mengalir." },
    { id: "f19", cat: "Fisika", title: "Mesin Carnot (Efisiensi)", latex: "\\eta = (1 - \\frac{T_r}{T_t}) \\times 100\\%", desc: "Efisiensi mesin kalor ideal." },
    { id: "f20", cat: "Fisika", title: "Kapasitor Keping", latex: "C = \\epsilon_0 \\frac{A}{d}", desc: "Kapasitas kapasitor keping sejajar." },

    // --- FISIKA (FLUIDA & TERMO) ---
    { id: "ft1", cat: "Fisika", title: "Tekanan Hidrostatis", latex: "P_h = \\rho g h", desc: "Tekanan zat cair pada kedalaman h." },
    { id: "ft2", cat: "Fisika", title: "Hukum Archimedes", latex: "F_A = \\rho_f g V_b", desc: "Gaya apung pada benda tercelup." },
    { id: "ft3", cat: "Fisika", title: "Hukum Pascal", latex: "\\frac{F_1}{A_1} = \\frac{F_2}{A_2}", desc: "Tekanan pada ruang tertutup diteruskan sama besar." },
    { id: "ft4", cat: "Fisika", title: "Kalor (Suhu)", latex: "Q = mc\\Delta T", desc: "Kalor untuk menaikkan suhu benda." },
    { id: "ft5", cat: "Fisika", title: "Kalor (Wujud)", latex: "Q = m \\cdot L", desc: "Kalor untuk mengubah wujud benda (laten)." },

    // --- FISIKA (LISTRIK & MAGNET) ---
    { id: "fl1", cat: "Fisika", title: "Hukum Coulomb", latex: "F = k \\frac{q_1 q_2}{r^2}", desc: "Gaya tarik/tolak antar muatan listrik." },
    { id: "fl2", cat: "Fisika", title: "Medan Listrik", latex: "E = k \\frac{q}{r^2}", desc: "Kuat medan listrik pada jarak r." },
    { id: "fl3", cat: "Fisika", title: "Hukum Ohm", latex: "V = I \\cdot R", desc: "Hubungan tegangan, arus, dan hambatan." },
    { id: "fl4", cat: "Fisika", title: "Hambatan Seri", latex: "R_s = R_1 + R_2 + R_3", desc: "Hambatan total rangkaian seri." },
    { id: "fl5", cat: "Fisika", title: "Hambatan Paralel", latex: "\\frac{1}{R_p} = \\frac{1}{R_1} + \\frac{1}{R_2}", desc: "Hambatan total rangkaian paralel." },
    { id: "fl6", cat: "Fisika", title: "Gaya Lorentz", latex: "F = B I L \\sin \\theta", desc: "Gaya magnet pada kawat berarus." },
    { id: "fl7", cat: "Fisika", title: "Relativitas Energi", latex: "E = mc^2", desc: "Kesetaraan massa dan energi Einstein." },

    // --- KIMIA ---
    { id: "k1", cat: "Kimia", title: "Konsep Mol (Massa)", latex: "n = \\frac{Gr}{Mr}", desc: "Hubungan mol dengan massa zat." },
    { id: "k2", cat: "Kimia", title: "Konsep Mol (Volume STP)", latex: "n = \\frac{V}{22.4}", desc: "Hubungan mol gas pada keadaan standar." },
    { id: "k3", cat: "Kimia", title: "Molaritas", latex: "M = \\frac{n}{V}", desc: "Konsentrasi larutan (mol per liter)." },
    { id: "k4", cat: "Kimia", title: "Pengenceran", latex: "M_1 V_1 = M_2 V_2", desc: "Membuat larutan lebih encer." },
    { id: "k5", cat: "Kimia", title: "pH Asam Kuat", latex: "pH = -\\log[H^+]", desc: "Menghitung derajat keasaman asam kuat." },
    { id: "k6", cat: "Kimia", title: "pH Basa Kuat", latex: "pOH = -\\log[OH^-]", desc: "Menghitung derajat kebasaan, pH = 14 - pOH." },
    { id: "k7", cat: "Kimia", title: "Hukum Gas Ideal", latex: "PV = nRT", desc: "Persamaan keadaan gas ideal." },
    { id: "k8", cat: "Kimia", title: "Laju Reaksi", latex: "v = k[A]^x[B]^y", desc: "Persamaan laju reaksi berdasarkan orde." }, 
    { id: "k9", cat: "Kimia", title: "Molalitas", latex: "m = \\frac{n}{p (kg)}", desc: "Mol zat terlarut per kilogram pelarut." },
    { id: "k10", cat: "Kimia", title: "Kenaikan Titik Didih", latex: "\\Delta T_b = K_b \\cdot m \\cdot i", desc: "Sifat koligatif: larutan mendidih lebih tinggi." },
    { id: "k11", cat: "Kimia", title: "Penurunan Titik Beku", latex: "\\Delta T_f = K_f \\cdot m \\cdot i", desc: "Sifat koligatif: larutan membeku lebih rendah." },
    { id: "k12", cat: "Kimia", title: "Tekanan Osmotik", latex: "\\pi = M \\cdot R \\cdot T \\cdot i", desc: "Tekanan minimum mencegah osmosis." },
    { id: "k13", cat: "Kimia", title: "Tetapan Kesetimbangan", latex: "K_c = \\frac{[C]^c [D]^d}{[A]^a [B]^b}", desc: "Rasio konsentrasi produk dan reaktan." },
    { id: "k14", cat: "Kimia", title: "Energi Bebas Gibbs", latex: "\\Delta G = \\Delta H - T \\Delta S", desc: "Menentukan kespontanan reaksi kimia." },
    { id: "k15", cat: "Kimia", title: "Persamaan Nernst", latex: "E = E^0 - \\frac{RT}{nF} \\ln Q", desc: "Potensial sel pada keadaan non-standar." }        
];


const ELEMENTS = [
    // --- PERIODE 1 ---
    {n:1, s:"H", name:"Hydrogen", mass:1.008, group:1, row:1, cat:"nonmetal"},
    {n:2, s:"He", name:"Helium", mass:4.0026, group:18, row:1, cat:"noble"},

    // --- PERIODE 2 ---
    {n:3, s:"Li", name:"Lithium", mass:6.94, group:1, row:2, cat:"alkali"},
    {n:4, s:"Be", name:"Beryllium", mass:9.0122, group:2, row:2, cat:"alkali-earth"},
    {n:5, s:"B", name:"Boron", mass:10.81, group:13, row:2, cat:"metalloid"},
    {n:6, s:"C", name:"Carbon", mass:12.011, group:14, row:2, cat:"nonmetal"},
    {n:7, s:"N", name:"Nitrogen", mass:14.007, group:15, row:2, cat:"nonmetal"},
    {n:8, s:"O", name:"Oxygen", mass:15.999, group:16, row:2, cat:"nonmetal"},
    {n:9, s:"F", name:"Fluorine", mass:18.998, group:17, row:2, cat:"halogen"},
    {n:10, s:"Ne", name:"Neon", mass:20.180, group:18, row:2, cat:"noble"},

    // --- PERIODE 3 ---
    {n:11, s:"Na", name:"Sodium", mass:22.990, group:1, row:3, cat:"alkali"},
    {n:12, s:"Mg", name:"Magnesium", mass:24.305, group:2, row:3, cat:"alkali-earth"},
    {n:13, s:"Al", name:"Aluminium", mass:26.982, group:13, row:3, cat:"post-transition"},
    {n:14, s:"Si", name:"Silicon", mass:28.085, group:14, row:3, cat:"metalloid"},
    {n:15, s:"P", name:"Phosphorus", mass:30.974, group:15, row:3, cat:"nonmetal"},
    {n:16, s:"S", name:"Sulfur", mass:32.06, group:16, row:3, cat:"nonmetal"},
    {n:17, s:"Cl", name:"Chlorine", mass:35.45, group:17, row:3, cat:"halogen"},
    {n:18, s:"Ar", name:"Argon", mass:39.948, group:18, row:3, cat:"noble"},

    // --- PERIODE 4 ---
    {n:19, s:"K", name:"Potassium", mass:39.098, group:1, row:4, cat:"alkali"},
    {n:20, s:"Ca", name:"Calcium", mass:40.078, group:2, row:4, cat:"alkali-earth"},
    {n:21, s:"Sc", name:"Scandium", mass:44.956, group:3, row:4, cat:"transition"},
    {n:22, s:"Ti", name:"Titanium", mass:47.867, group:4, row:4, cat:"transition"},
    {n:23, s:"V", name:"Vanadium", mass:50.942, group:5, row:4, cat:"transition"},
    {n:24, s:"Cr", name:"Chromium", mass:51.996, group:6, row:4, cat:"transition"},
    {n:25, s:"Mn", name:"Manganese", mass:54.938, group:7, row:4, cat:"transition"},
    {n:26, s:"Fe", name:"Iron", mass:55.845, group:8, row:4, cat:"transition"},
    {n:27, s:"Co", name:"Cobalt", mass:58.933, group:9, row:4, cat:"transition"},
    {n:28, s:"Ni", name:"Nickel", mass:58.693, group:10, row:4, cat:"transition"},
    {n:29, s:"Cu", name:"Copper", mass:63.546, group:11, row:4, cat:"transition"},
    {n:30, s:"Zn", name:"Zinc", mass:65.38, group:12, row:4, cat:"transition"},
    {n:31, s:"Ga", name:"Gallium", mass:69.723, group:13, row:4, cat:"post-transition"},
    {n:32, s:"Ge", name:"Germanium", mass:72.630, group:14, row:4, cat:"metalloid"},
    {n:33, s:"As", name:"Arsenic", mass:74.922, group:15, row:4, cat:"metalloid"},
    {n:34, s:"Se", name:"Selenium", mass:78.96, group:16, row:4, cat:"nonmetal"},
    {n:35, s:"Br", name:"Bromine", mass:79.904, group:17, row:4, cat:"halogen"},
    {n:36, s:"Kr", name:"Krypton", mass:83.798, group:18, row:4, cat:"noble"},

    // --- PERIODE 5 ---
    {n:37, s:"Rb", name:"Rubidium", mass:85.468, group:1, row:5, cat:"alkali"},
    {n:38, s:"Sr", name:"Strontium", mass:87.62, group:2, row:5, cat:"alkali-earth"},
    {n:39, s:"Y", name:"Yttrium", mass:88.906, group:3, row:5, cat:"transition"},
    {n:40, s:"Zr", name:"Zirconium", mass:91.224, group:4, row:5, cat:"transition"},
    {n:41, s:"Nb", name:"Niobium", mass:92.906, group:5, row:5, cat:"transition"},
    {n:42, s:"Mo", name:"Molybdenum", mass:95.95, group:6, row:5, cat:"transition"},
    {n:43, s:"Tc", name:"Technetium", mass:98, group:7, row:5, cat:"transition"},
    {n:44, s:"Ru", name:"Ruthenium", mass:101.07, group:8, row:5, cat:"transition"},
    {n:45, s:"Rh", name:"Rhodium", mass:102.91, group:9, row:5, cat:"transition"},
    {n:46, s:"Pd", name:"Palladium", mass:106.42, group:10, row:5, cat:"transition"},
    {n:47, s:"Ag", name:"Silver", mass:107.87, group:11, row:5, cat:"transition"},
    {n:48, s:"Cd", name:"Cadmium", mass:112.41, group:12, row:5, cat:"transition"},
    {n:49, s:"In", name:"Indium", mass:114.82, group:13, row:5, cat:"post-transition"},
    {n:50, s:"Sn", name:"Tin", mass:118.71, group:14, row:5, cat:"post-transition"},
    {n:51, s:"Sb", name:"Antimony", mass:121.76, group:15, row:5, cat:"metalloid"},
    {n:52, s:"Te", name:"Tellurium", mass:127.60, group:16, row:5, cat:"metalloid"},
    {n:53, s:"I", name:"Iodine", mass:126.90, group:17, row:5, cat:"halogen"},
    {n:54, s:"Xe", name:"Xenon", mass:131.29, group:18, row:5, cat:"noble"},

    // --- PERIODE 6 ---
    {n:55, s:"Cs", name:"Cesium", mass:132.91, group:1, row:6, cat:"alkali"},
    {n:56, s:"Ba", name:"Barium", mass:137.33, group:2, row:6, cat:"alkali-earth"},
    // 57-71 Lanthanides (Lihat bawah)
    {n:72, s:"Hf", name:"Hafnium", mass:178.49, group:4, row:6, cat:"transition"},
    {n:73, s:"Ta", name:"Tantalum", mass:180.95, group:5, row:6, cat:"transition"},
    {n:74, s:"W", name:"Tungsten", mass:183.84, group:6, row:6, cat:"transition"},
    {n:75, s:"Re", name:"Rhenium", mass:186.21, group:7, row:6, cat:"transition"},
    {n:76, s:"Os", name:"Osmium", mass:190.23, group:8, row:6, cat:"transition"},
    {n:77, s:"Ir", name:"Iridium", mass:192.22, group:9, row:6, cat:"transition"},
    {n:78, s:"Pt", name:"Platinum", mass:195.08, group:10, row:6, cat:"transition"},
    {n:79, s:"Au", name:"Gold", mass:196.97, group:11, row:6, cat:"transition"},
    {n:80, s:"Hg", name:"Mercury", mass:200.59, group:12, row:6, cat:"transition"},
    {n:81, s:"Tl", name:"Thallium", mass:204.38, group:13, row:6, cat:"post-transition"},
    {n:82, s:"Pb", name:"Lead", mass:207.2, group:14, row:6, cat:"post-transition"},
    {n:83, s:"Bi", name:"Bismuth", mass:208.98, group:15, row:6, cat:"post-transition"},
    {n:84, s:"Po", name:"Polonium", mass:209, group:16, row:6, cat:"post-transition"},
    {n:85, s:"At", name:"Astatine", mass:210, group:17, row:6, cat:"halogen"},
    {n:86, s:"Rn", name:"Radon", mass:222, group:18, row:6, cat:"noble"},

    // --- PERIODE 7 ---
    {n:87, s:"Fr", name:"Francium", mass:223, group:1, row:7, cat:"alkali"},
    {n:88, s:"Ra", name:"Radium", mass:226, group:2, row:7, cat:"alkali-earth"},
    // 89-103 Actinides (Lihat bawah)
    {n:104, s:"Rf", name:"Rutherfordium", mass:267, group:4, row:7, cat:"transition"},
    {n:105, s:"Db", name:"Dubnium", mass:268, group:5, row:7, cat:"transition"},
    {n:106, s:"Sg", name:"Seaborgium", mass:271, group:6, row:7, cat:"transition"},
    {n:107, s:"Bh", name:"Bohrium", mass:272, group:7, row:7, cat:"transition"},
    {n:108, s:"Hs", name:"Hassium", mass:270, group:8, row:7, cat:"transition"},
    {n:109, s:"Mt", name:"Meitnerium", mass:276, group:9, row:7, cat:"transition"},
    {n:110, s:"Ds", name:"Darmstadtium", mass:281, group:10, row:7, cat:"transition"},
    {n:111, s:"Rg", name:"Roentgenium", mass:280, group:11, row:7, cat:"transition"},
    {n:112, s:"Cn", name:"Copernicium", mass:285, group:12, row:7, cat:"transition"},
    {n:113, s:"Nh", name:"Nihonium", mass:284, group:13, row:7, cat:"post-transition"},
    {n:114, s:"Fl", name:"Flerovium", mass:289, group:14, row:7, cat:"post-transition"},
    {n:115, s:"Mc", name:"Moscovium", mass:288, group:15, row:7, cat:"post-transition"},
    {n:116, s:"Lv", name:"Livermorium", mass:293, group:16, row:7, cat:"post-transition"},
    {n:117, s:"Ts", name:"Tennessine", mass:294, group:17, row:7, cat:"halogen"},
    {n:118, s:"Og", name:"Oganesson", mass:294, group:18, row:7, cat:"noble"},

    // --- LANTANIDA (Row 8 visual) ---
    {n:57, s:"La", name:"Lanthanum", mass:138.91, group:3, row:8, cat:"lanthanide"},
    {n:58, s:"Ce", name:"Cerium", mass:140.12, group:4, row:8, cat:"lanthanide"},
    {n:59, s:"Pr", name:"Praseodymium", mass:140.91, group:5, row:8, cat:"lanthanide"},
    {n:60, s:"Nd", name:"Neodymium", mass:144.24, group:6, row:8, cat:"lanthanide"},
    {n:61, s:"Pm", name:"Promethium", mass:145, group:7, row:8, cat:"lanthanide"},
    {n:62, s:"Sm", name:"Samarium", mass:150.36, group:8, row:8, cat:"lanthanide"},
    {n:63, s:"Eu", name:"Europium", mass:151.96, group:9, row:8, cat:"lanthanide"},
    {n:64, s:"Gd", name:"Gadolinium", mass:157.25, group:10, row:8, cat:"lanthanide"},
    {n:65, s:"Tb", name:"Terbium", mass:158.93, group:11, row:8, cat:"lanthanide"},
    {n:66, s:"Dy", name:"Dysprosium", mass:162.50, group:12, row:8, cat:"lanthanide"},
    {n:67, s:"Ho", name:"Holmium", mass:164.93, group:13, row:8, cat:"lanthanide"},
    {n:68, s:"Er", name:"Erbium", mass:167.26, group:14, row:8, cat:"lanthanide"},
    {n:69, s:"Tm", name:"Thulium", mass:168.93, group:15, row:8, cat:"lanthanide"},
    {n:70, s:"Yb", name:"Ytterbium", mass:173.05, group:16, row:8, cat:"lanthanide"},
    {n:71, s:"Lu", name:"Lutetium", mass:174.97, group:17, row:8, cat:"lanthanide"},

    // --- AKTINIDA (Row 9 visual) ---
    {n:89, s:"Ac", name:"Actinium", mass:227, group:3, row:9, cat:"actinide"},
    {n:90, s:"Th", name:"Thorium", mass:232.04, group:4, row:9, cat:"actinide"},
    {n:91, s:"Pa", name:"Protactinium", mass:231.04, group:5, row:9, cat:"actinide"},
    {n:92, s:"U", name:"Uranium", mass:238.03, group:6, row:9, cat:"actinide"},
    {n:93, s:"Np", name:"Neptunium", mass:237, group:7, row:9, cat:"actinide"},
    {n:94, s:"Pu", name:"Plutonium", mass:244, group:8, row:9, cat:"actinide"},
    {n:95, s:"Am", name:"Americium", mass:243, group:9, row:9, cat:"actinide"},
    {n:96, s:"Cm", name:"Curium", mass:247, group:10, row:9, cat:"actinide"},
    {n:97, s:"Bk", name:"Berkelium", mass:247, group:11, row:9, cat:"actinide"},
    {n:98, s:"Cf", name:"Californium", mass:251, group:12, row:9, cat:"actinide"},
    {n:99, s:"Es", name:"Einsteinium", mass:252, group:13, row:9, cat:"actinide"},
    {n:100, s:"Fm", name:"Fermium", mass:257, group:14, row:9, cat:"actinide"},
    {n:101, s:"Md", name:"Mendelevium", mass:258, group:15, row:9, cat:"actinide"},
    {n:102, s:"No", name:"Nobelium", mass:259, group:16, row:9, cat:"actinide"},
    {n:103, s:"Lr", name:"Lawrencium", mass:262, group:17, row:9, cat:"actinide"}
];

        // --- 2. UI NAVIGATION LOGIC ---
        function switchTab(targetId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${targetId}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active', 'bg-white/10', 'text-white'));
            document.querySelector(`[data-target="${targetId}"]`).classList.add('active', 'bg-white/10', 'text-white');

        const titles = { home: "Home", dashboard: "Dashboard", rumus: "Bank Rumus", tools: "Tools & Lab", periodic: "Tabel Periodik", quiz: "Kuis Arena" };
        document.getElementById('pageTitle').innerText = titles[targetId];
            document.getElementById('pageTitle').innerText = titles[targetId];
            
            // Special Init
            if(targetId === 'rumus') renderRumus(FORMULA_DB);
            if(targetId === 'periodic') renderPeriodic();
        }

        // --- 3. FORMULA RENDERER ENGINE ---
        function renderRumus(data) {
            const container = document.getElementById('rumusContainer');
            container.innerHTML = '';
            data.forEach(item => {
                const color = item.cat === 'Matematika' ? 'border-blue-500' : item.cat === 'Fisika' ? 'border-purple-500' : 'border-green-500';
                const div = document.createElement('div');
                div.className = `glass p-6 rounded-2xl border-t-4 ${color} hover:bg-white/5 transition`;
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-lg text-white">${item.title}</h4>
                        <span class="text-xs bg-white/10 px-2 py-1 rounded text-slate-300">${item.cat}</span>
                    </div>
                    <div class="my-4 text-center text-xl py-2 bg-black/20 rounded font-mono overflow-x-auto">
                        $$${item.latex}$$
                    </div>
                    <p class="text-sm text-slate-400">${item.desc}</p>
                `;
                container.appendChild(div);
            });
            MathJax.typesetPromise();
        }

        function filterRumus(cat) {
            if(cat === 'all') renderRumus(FORMULA_DB);
            else renderRumus(FORMULA_DB.filter(x => x.cat === cat));
        }

        // Global Search
        document.getElementById('globalSearch').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            if(term.length > 0) {
                switchTab('rumus');
                const filtered = FORMULA_DB.filter(x => 
                    x.title.toLowerCase().includes(term) || x.desc.toLowerCase().includes(term)
                );
                renderRumus(filtered);
            } else {
                renderRumus(FORMULA_DB);
            }
        });

        // --- 4. SCIENTIFIC CALCULATOR LOGIC ---
        let calcStr = "";
        function calcIn(v) {
            calcStr += v;
            document.getElementById('calcDisplay').innerText = calcStr;
        }
        function calcClear() {
            calcStr = "";
            document.getElementById('calcDisplay').innerText = "0";
        }
        function calcDel() {
            calcStr = calcStr.slice(0, -1);
            document.getElementById('calcDisplay').innerText = calcStr || "0";
        }
        function calcResult() {
            try {
                // Safety replacement for scientific functions
                let evalStr = calcStr
                    .replace(/sin/g, 'Math.sin')
                    .replace(/cos/g, 'Math.cos')
                    .replace(/tan/g, 'Math.tan')
                    .replace(/log/g, 'Math.log10')
                    .replace(/sqrt/g, 'Math.sqrt')
                    .replace(/\^/g, '**');
                
                const res = eval(evalStr);
                document.getElementById('calcDisplay').innerText = Number.isInteger(res) ? res : res.toFixed(6);
                calcStr = res.toString();
            } catch (e) {
                document.getElementById('calcDisplay').innerText = "Error";
                setTimeout(calcClear, 1000);
            }
        }

        // --- 5. PERIODIC TABLE GENERATOR ---
        function renderPeriodic() {
            const grid = document.getElementById('periodicTable');
            if(grid.children.length > 0) return; // Already rendered

            // Create 18x7 grid placeholders
            // Note: This is a simplified logic for demo. In full version, map coordinates precisely.
            for(let i=0; i<126; i++) {
                const cell = document.createElement('div');
                grid.appendChild(cell);
            }

            // Place Elements
            ELEMENTS.forEach(el => {
                const div = document.createElement('div');
                
                // LOGIKA WARNA BERDASARKAN KATEGORI
                let colorClass = "bg-slate-700/50 border-slate-600"; // Default
                
                if(el.cat.includes("alkali") && !el.cat.includes("earth")) colorClass = "bg-red-600/40 border-red-500";
                else if(el.cat.includes("alkali-earth")) colorClass = "bg-orange-500/40 border-orange-400";
                else if(el.cat.includes("transition")) colorClass = "bg-blue-600/40 border-blue-500";
                else if(el.cat.includes("noble")) colorClass = "bg-purple-600/40 border-purple-500";
                else if(el.cat.includes("halogen")) colorClass = "bg-cyan-600/40 border-cyan-400";
                else if(el.cat.includes("metalloid")) colorClass = "bg-pink-600/40 border-pink-400";
                else if(el.cat.includes("nonmetal")) colorClass = "bg-green-600/40 border-green-500";
                else if(el.cat.includes("post-transition")) colorClass = "bg-teal-600/40 border-teal-500";
                else if(el.cat.includes("lanthanide") || el.cat.includes("actinide")) colorClass = "bg-indigo-600/40 border-indigo-500";

                // Tambahkan styling border dan hover glow
                div.className = `element-card rounded-lg text-xs text-white p-1 border ${colorClass} hover:brightness-125 hover:shadow-[0_0_15px_rgba(255,255,255,0.3)] transition-all duration-300 relative overflow-hidden group`;
                
                div.style.gridColumn = el.group;
                div.style.gridRow = el.row;
                
                // Isi HTML Kartu
                div.innerHTML = `
                    <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition"></div>
                    <span class="text-[8px] opacity-70">${el.n}</span>
                    <strong class="text-sm md:text-lg block font-bold tracking-tighter shadow-black drop-shadow-md">${el.s}</strong>
                    <span class="text-[6px] opacity-0 group-hover:opacity-100 transition absolute bottom-1 left-1 truncate w-full">${el.name}</span>
                `;
                div.onclick = () => showElementDetail(el);
                
                grid.appendChild(div);
            });
        }

        function showElementDetail(el) {
            const box = document.getElementById('elementDetail');
            box.classList.remove('hidden');
            document.getElementById('elName').innerHTML = `${el.name} (${el.s})`;
            document.getElementById('elDesc').innerHTML = `
                Nomor Atom: ${el.n}<br>
                Massa Atom: ${el.mass}<br>
                Golongan: ${el.group}
            `;
        }

// --- 6. QUIZ ENGINE, XP SYSTEM & ACHIEVEMENTS ---

// A. SYSTEM VARIABLES
// Menggunakan nama key baru ('meletup_xp', dll) agar progress lama ter-reset dan mulai dari 0
let userXP = parseInt(localStorage.getItem('meletup_xp')) || 0;
let streak = 0;
let answeredCount = parseInt(localStorage.getItem('meletup_answered')) || 0;

// B. DATABASE ACHIEVEMENT
const ACHIEVEMENTS = [
    { id: "first_blood", title: "Basic Math Level", desc: "Menjawab 1 soal dengan benar.", xp: 50, condition: () => answeredCount >= 1 },
    { id: "rookie", title: "Core Formation", desc: "Mencapai Level 2.", xp: 100, condition: () => getLevel(userXP) >= 2 },
    { id: "streak_5", title: "Internal Arts Mastery", desc: "Menjawab 5 soal benar berturut-turut.", xp: 200, condition: () => streak >= 5 },
    { id: "master", title: "Transcendent Realm", desc: "Mencapai Level 5.", xp: 500, condition: () => getLevel(userXP) >= 5 },
    { id: "grinder", title: "Math Peak", desc: "Menjawab total 20 soal.", xp: 300, condition: () => answeredCount >= 20 }
];

// C. LOGIKA LEVELING
function getLevel(xp) {
    return Math.floor(xp / 500) + 1; // Level naik setiap 500 XP
}

function getRank(level) {
    if(level < 2) return "Novice";
    if(level < 5) return "Apprentice";
    if(level < 10) return "Adept";
    if(level < 20) return "Expert";
    return "Grandmaster";
}

function updateXPUI() {
    const lvl = getLevel(userXP);
    const nextLvlXP = lvl * 500;
    const prevLvlXP = (lvl - 1) * 500;
    const currentLvlProgress = userXP - prevLvlXP;
    const requiredProgress = nextLvlXP - prevLvlXP;
    const percent = (currentLvlProgress / requiredProgress) * 100;

    document.getElementById('userLevel').innerText = lvl;
    document.getElementById('rankName').innerText = getRank(lvl);
    document.getElementById('currentXP').innerText = `${currentLvlProgress} XP`;
    document.getElementById('nextXP').innerText = `${requiredProgress} XP`;
    document.getElementById('xpBar').style.width = `${percent}%`;
    
    // Simpan ke LocalStorage dengan key BARU agar data tidak bentrok dengan versi lama
    localStorage.setItem('meletup_xp', userXP);
    localStorage.setItem('meletup_answered', answeredCount);
}

// D. LOGIKA ACHIEVEMENT
function checkAchievements() {
    // Ambil data achievement yang sudah terbuka dari storage baru
    let unlocked = JSON.parse(localStorage.getItem('meletup_unlocked')) || [];
    let newUnlock = false;

    ACHIEVEMENTS.forEach(ach => {
        // Cek 2 hal: 
        // 1. Apakah ID achievement ini BELUM ada di daftar unlocked?
        // 2. Apakah kondisi terpenuhi?
        if (!unlocked.includes(ach.id) && ach.condition()) {
            unlocked.push(ach.id);
            // Bonus XP dari achievement
            userXP += ach.xp;
            
            // Tampilkan notifikasi
            alert(`ðŸ† ACHIEVEMENT UNLOCKED: ${ach.title}\n(+${ach.xp} XP)`);
            newUnlock = true;
        }
    });

    if(newUnlock) {
        // Simpan daftar yang sudah terbuka agar tidak ter-klaim lagi saat refresh
        localStorage.setItem('meletup_unlocked', JSON.stringify(unlocked));
        updateXPUI();
    }
}

function toggleAchievements() {
    const modal = document.getElementById('achModal');
    const list = document.getElementById('achList');
    // Baca dari storage baru
    const unlocked = JSON.parse(localStorage.getItem('meletup_unlocked')) || [];
    
    modal.classList.toggle('hidden');
    
    if(!modal.classList.contains('hidden')) {
        list.innerHTML = '';
        ACHIEVEMENTS.forEach(ach => {
            const isUnlocked = unlocked.includes(ach.id);
            const div = document.createElement('div');
            div.className = `p-4 rounded-xl border ${isUnlocked ? 'bg-yellow-500/10 border-yellow-500/50' : 'bg-slate-800/50 border-white/5'} flex items-center gap-4`;
            div.innerHTML = `
                <div class="p-3 rounded-full ${isUnlocked ? 'bg-yellow-500 text-black' : 'bg-slate-700 text-slate-500'}">
                    <i data-lucide="${isUnlocked ? 'medal' : 'lock'}" class="w-5 h-5"></i>
                </div>
                <div class="flex-1">
                    <h4 class="font-bold ${isUnlocked ? 'text-white' : 'text-slate-500'}">${ach.title}</h4>
                    <p class="text-xs ${isUnlocked ? 'text-slate-300' : 'text-slate-600'}">${ach.desc}</p>
                </div>
                ${isUnlocked ? '<span class="text-xs font-bold text-yellow-400">âœ“</span>' : ''}
            `;
            list.appendChild(div);
        });
        lucide.createIcons();
    }
}

// E. LOGIKA KUIS (Updated & Expanded)
const EXTRA_QUESTIONS = [
    // LOGIKA & UMUM
    { id: "q1", cat: "Logika", title: "Biner dari 5", latex: "101", desc: "Konversi desimal ke biner." },
    { id: "q2", cat: "Logika", title: "Hex dari 15", latex: "F", desc: "Sistem bilangan basis 16." },
    { id: "q3", cat: "Logika", title: "Gerbang AND (1,0)", latex: "0", desc: "Logika boolean: True AND False = False." },
    { id: "q4", cat: "Logika", title: "Gerbang OR (1,0)", latex: "1", desc: "Logika boolean: True OR False = True." },
    { id: "q5", cat: "Umum", title: "Kecepatan Cahaya", latex: "3 \\times 10^8 \\, m/s", desc: "Kecepatan foton dalam vakum (c)." },
    { id: "q6", cat: "Umum", title: "Bilangan Euler", latex: "e \\approx 2.718", desc: "Basis logaritma natural." },
    { id: "q7", cat: "Umum", title: "Phi", latex: "\\pi \\approx 3.14", desc: "Rasio keliling lingkaran terhadap diameter." },
    
    // BIOLOGI
    { id: "b1", cat: "Biologi", title: "Pusat Sel", latex: "Nukleus", desc: "Organel pengatur aktivitas sel." },
    { id: "b2", cat: "Biologi", title: "Pembangkit Energi Sel", latex: "Mitokondria", desc: "Tempat respirasi seluler (The Powerhouse)." },
    { id: "b3", cat: "Biologi", title: "Pembawa Sifat", latex: "DNA", desc: "Deoxyribonucleic acid." },
    { id: "b4", cat: "Biologi", title: "Alat Pernapasan Ikan", latex: "Insang", desc: "Organ pertukaran oksigen di air." },
    { id: "b5", cat: "Biologi", title: "Fotosintesis", latex: "6CO_2 + 6H_2O \\to C_6H_{12}O_6 + 6O_2", desc: "Reaksi kimia pembentukan glukosa pada tumbuhan." },

    // KIMIA DASAR
    { id: "k_w", cat: "Kimia", title: "Rumus Air", latex: "H_2O", desc: "Dihidrogen monoksida." },
    { id: "k_s", cat: "Kimia", title: "Garam Dapur", latex: "NaCl", desc: "Natrium Klorida." },
    { id: "k_a", cat: "Kimia", title: "Asam Lambung", latex: "HCl", desc: "Asam Klorida." },
    
    // FISIKA DASAR
    { id: "f_v", cat: "Fisika", title: "Hukum Ohm", latex: "V = I \\cdot R", desc: "Hubungan tegangan, arus, dan hambatan." },
    { id: "f_d", cat: "Fisika", title: "Massa Jenis", latex: "\\rho = \\frac{m}{V}", desc: "Kerapatan suatu zat." }
];

// Menggabungkan database rumus dengan soal tambahan untuk kuis
const QUIZ_POOL = [...FORMULA_DB, ...EXTRA_QUESTIONS];

let currentQuiz = null;
let quizScore = 0;

function startQuiz() {
    quizScore = 0;
    streak = 0;
    document.getElementById('quizScore').innerText = quizScore;
    nextQuestion();
}

function nextQuestion() {
    const q = QUIZ_POOL[Math.floor(Math.random() * QUIZ_POOL.length)];
    currentQuiz = q;
    
    document.getElementById('quizQuestion').innerHTML = `Apa rumus/nilai dari <br><span class="text-blue-400">"${q.title}"</span>?`;
    
    const optsDiv = document.getElementById('quizOptions');
    optsDiv.innerHTML = '';
    
    // Ambil 3 jawaban salah
    const wrong = QUIZ_POOL.filter(x => x.id !== q.id).sort(() => 0.5 - Math.random()).slice(0, 3);
    const options = [...wrong, q].sort(() => 0.5 - Math.random());

    options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = "p-4 rounded-xl bg-white/5 hover:bg-white/10 text-left border border-white/10 transition flex items-center gap-3 group";
        btn.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-slate-400 group-hover:bg-blue-600 group-hover:text-white transition">?</div>
            <span class="font-mono text-sm flex-1">$$${opt.latex}$$</span>
        `;
        btn.onclick = () => checkAnswer(opt.id);
        optsDiv.appendChild(btn);
    });
    MathJax.typesetPromise();
}

// GANTI FUNCTION checkAnswer() YANG LAMA DENGAN BLOK KODE INI:

// --- FUNGSI POPUP KUIS BARU ---

function showQuizResult(isCorrect, xpGain, currentStreak) {
    const modal = document.getElementById('quizResultModal');
    const card = document.getElementById('quizResultCard');
    const icon = document.getElementById('qResIcon');
    const title = document.getElementById('qResTitle');
    const desc = document.getElementById('qResDesc');
    const btn = document.getElementById('qResBtn');
    const stats = document.getElementById('qResStats');

    modal.classList.remove('hidden');
    
    // Efek Zoom In
    setTimeout(() => card.classList.remove('scale-95'), 50);

    if (isCorrect) {
        // Tampilan BENAR (Hijau)
        card.className = "glass p-8 rounded-3xl max-w-sm w-full text-center border-2 border-green-500 relative transform transition-all duration-300 scale-95";
        icon.className = "w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 bg-green-500 text-white shadow-[0_0_30px_rgba(34,197,94,0.5)] animate-bounce";
        icon.innerHTML = '<i data-lucide="check" class="w-10 h-10"></i>';
        title.innerText = "LUAR BIASA!";
        title.className = "text-3xl font-black text-green-400 mb-2 uppercase tracking-wider";
        desc.innerText = `Jawaban Tepat! Kamu dapat +${xpGain} XP`;
        
        btn.className = "w-full py-3 rounded-xl font-bold text-white shadow-lg transition transform hover:scale-105 bg-green-600 hover:bg-green-500";
        btn.innerText = "Lanjut Soal Berikutnya â†’";
        
        // Update Stats di Popup
        stats.classList.remove('hidden');
        document.getElementById('qResStreak').innerText = currentStreak + "x";
        document.getElementById('qResScore').innerText = quizScore;

    } else {
        // Tampilan SALAH (Merah)
        card.className = "glass p-8 rounded-3xl max-w-sm w-full text-center border-2 border-red-500 relative transform transition-all duration-300 scale-95";
        icon.className = "w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 bg-red-500 text-white shadow-[0_0_30px_rgba(239,68,68,0.5)] animate-pulse";
        icon.innerHTML = '<i data-lucide="x" class="w-10 h-10"></i>';
        title.innerText = "YAH, SALAH...";
        title.className = "text-3xl font-black text-red-400 mb-2 uppercase tracking-wider";
        desc.innerText = "Jangan menyerah! Coba pelajari rumusnya lagi.";
        
        btn.className = "w-full py-3 rounded-xl font-bold text-white shadow-lg transition transform hover:scale-105 bg-slate-700 hover:bg-slate-600";
        btn.innerText = "Coba Lagi";
        
        stats.classList.add('hidden');
    }
    lucide.createIcons();
}

function closeQuizResult() {
    const modal = document.getElementById('quizResultModal');
    const card = document.getElementById('quizResultCard');
    
    card.classList.add('scale-95'); // Zoom out effect
    setTimeout(() => {
        modal.classList.add('hidden');
        nextQuestion(); // Lanjut ke soal berikutnya otomatis saat ditutup
    }, 200);
}

// Fungsi Check Answer yang sudah dimodifikasi
function checkAnswer(id) {
    if(id === currentQuiz.id) {
        // BENAR
        const xpGain = 50 + (streak * 10); 
        userXP += xpGain;
        quizScore += 100;
        streak++;
        answeredCount++;
        
        document.getElementById('quizScore').innerText = quizScore;
        updateXPUI();
        checkAchievements(); 
        
        // PANGGIL POPUP BARU (Mode Benar)
        showQuizResult(true, xpGain, streak);
        
    } else {
        // SALAH
        streak = 0;
        // PANGGIL POPUP BARU (Mode Salah)
        showQuizResult(false, 0, 0);
    }
}

// Init XP saat load
updateXPUI();

        // --- 7. TOOLS & SIMULATIONS ---
        function renderEnergyInputs() {
            const type = document.getElementById('energyType').value;
            const box = document.getElementById('energyInputs');
            let html = '';
            if(type === 'Ek') html = '<input id="in_m" placeholder="Massa (kg)" class="w-full bg-slate-900 p-2 rounded border border-slate-700"><input id="in_v" placeholder="Kecepatan (m/s)" class="w-full bg-slate-900 p-2 rounded border border-slate-700">';
            else if (type === 'Ep') html = '<input id="in_m" placeholder="Massa (kg)" class="w-full bg-slate-900 p-2 rounded border border-slate-700"><input id="in_h" placeholder="Tinggi (m)" class="w-full bg-slate-900 p-2 rounded border border-slate-700">';
            else html = '<input id="in_f" placeholder="Gaya (N)" class="w-full bg-slate-900 p-2 rounded border border-slate-700"><input id="in_s" placeholder="Jarak (m)" class="w-full bg-slate-900 p-2 rounded border border-slate-700">';
            box.innerHTML = html;
        }
        renderEnergyInputs();

        function calcEnergy() {
            const type = document.getElementById('energyType').value;
            let res = 0;
            if(type === 'Ek') {
                const m = parseFloat(document.getElementById('in_m').value) || 0;
                const v = parseFloat(document.getElementById('in_v').value) || 0;
                res = 0.5 * m * v * v;
            } else if (type === 'Ep') {
                const m = parseFloat(document.getElementById('in_m').value) || 0;
                const h = parseFloat(document.getElementById('in_h').value) || 0;
                res = m * 9.8 * h;
            } else {
                const f = parseFloat(document.getElementById('in_f').value) || 0;
                const s = parseFloat(document.getElementById('in_s').value) || 0;
                res = f * s;
            }
            document.getElementById('energyResult').innerText = res.toFixed(2) + " J";
        }

        function runProjectile() {
            const v0 = parseFloat(document.getElementById('sim_v0').value);
            const ang = parseFloat(document.getElementById('sim_ang').value);
            const rad = ang * Math.PI / 180;
            const g = 10;
            const tmax = (2*v0*Math.sin(rad))/g;
            
            let x=[], y=[];
            for(let t=0; t<=tmax; t+=0.1) {
                x.push(v0*Math.cos(rad)*t);
                y.push(v0*Math.sin(rad)*t - 0.5*g*t*t);
            }
            Plotly.newPlot('projectilePlot', [{x:x, y:y, mode:'lines', line:{color:'#ec4899'}}], 
            {paper_bgcolor:'rgba(0,0,0,0)', plot_bgcolor:'rgba(0,0,0,0)', margin:{t:10,l:30,r:10,b:30}, xaxis:{color:'#94a3b8'}, yaxis:{color:'#94a3b8'}});
        }

        // --- 8. STATS ---
        function runStats() {
            const val = document.getElementById('statsInput').value;
            const arr = val.split(',').map(x => parseFloat(x.trim())).filter(n => !isNaN(n));
            if(arr.length === 0) return;
            const mean = arr.reduce((a,b)=>a+b,0)/arr.length;
            const sorted = [...arr].sort((a,b)=>a-b);
            const mid = Math.floor(sorted.length/2);
            const median = sorted.length%2!==0 ? sorted[mid] : (sorted[mid-1]+sorted[mid])/2;
            const sd = Math.sqrt(arr.map(x=>Math.pow(x-mean,2)).reduce((a,b)=>a+b,0)/arr.length);
            
            document.getElementById('statsOutput').innerHTML = `
                 <div class="flex justify-between border-b border-white/10 pb-1"><span>Mean:</span> <span class="text-white font-bold">${mean.toFixed(2)}</span></div>
                 <div class="flex justify-between border-b border-white/10 pb-1"><span>Median:</span> <span class="text-white font-bold">${median.toFixed(2)}</span></div>
                 <div class="flex justify-between"><span>Std Dev:</span> <span class="text-white font-bold">${sd.toFixed(2)}</span></div>
            `;
        }

        // --- 9. BOT & INIT ---
        function toggleBot() {
            const b = document.getElementById('botModal');
            b.classList.toggle('hidden');
        }
        function sendBot() {
            const inp = document.getElementById('botInput');
            const txt = inp.value.trim();
            if(!txt) return;
            const chat = document.getElementById('botChat');
            chat.innerHTML += `<div class="bg-blue-600 p-2 rounded-lg self-end rounded-tr-none ml-auto max-w-[80%] text-white mb-2">${txt}</div>`;
            inp.value = "";
            
            // Smart Search Response
            const found = FORMULA_DB.find(x => x.title.toLowerCase().includes(txt.toLowerCase()));
            setTimeout(() => {
                let reply = "Maaf, saya belum tau rumus itu.";
                if(found) reply = `Coba cek rumus <b>${found.title}</b>: $$${found.latex}$$`;
                else if(txt.includes("halo")) reply = "Halo! Siap belajar apa hari ini?";
                
                chat.innerHTML += `<div class="bg-slate-700/50 p-2 rounded-lg self-start rounded-tl-none max-w-[80%] text-slate-200 mb-2">${reply}</div>`;
                MathJax.typesetPromise([chat]);
                chat.scrollTop = chat.scrollHeight;
            }, 500);
        }

        // Initialize
        lucide.createIcons();
        runProjectile();
        
        // Background Particle Animation (Enhanced Version)
        const canvas = document.getElementById('bgCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class P {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.8; // Kecepatan sedikit dinaikkan
                this.vy = (Math.random() - 0.5) * 0.8;
                this.s = Math.random() * 3 + 2; // Ukuran dipertebal (2px sampai 5px)
                this.a = Math.random() * 0.5 + 0.3; // Opacity lebih solid
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                // Reset jika keluar layar
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) this.reset();
            }
            draw() {
                // Efek Glow
                ctx.shadowBlur = 15;
                ctx.shadowColor = "rgba(96, 165, 250, 0.8)";
                
                ctx.fillStyle = `rgba(96, 165, 250, ${this.a})`; // Warna Biru Terang
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.s, 0, Math.PI * 2);
                ctx.fill();
                
                // Reset shadow agar tidak berat
                ctx.shadowBlur = 0;
            }
        }

        // Tambah jumlah partikel agar lebih ramai
        for (let i = 0; i < 85; i++) particles.push(new P());

        function anim() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Loop Partikel & Garis Penghubung (Constellation Effect)
            for (let i = 0; i < particles.length; i++) {
                let p1 = particles[i];
                p1.update();
                p1.draw();

                // Cek jarak ke partikel lain untuk menggambar garis
                for (let j = i; j < particles.length; j++) {
                    let p2 = particles[j];
                    let dx = p1.x - p2.x;
                    let dy = p1.y - p2.y;
                    let dist = Math.sqrt(dx*dx + dy*dy);

                    if (dist < 130) { // Jarak koneksi
                        ctx.beginPath();
                        // Garis semakin transparan jika jarak menjauh
                        ctx.strokeStyle = `rgba(96, 165, 250, ${0.25 - dist/600})`; 
                        ctx.lineWidth = 1.5; // Garis dipertebal sedikit
                        ctx.moveTo(p1.x, p1.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                }
            }
            requestAnimationFrame(anim);
        }
        anim();

// --- UNIT CONVERTER LOGIC ---
const UNITS = {
    len: { 'm':1, 'km':1000, 'cm':0.01, 'mm':0.001, 'inch':0.0254, 'ft':0.3048 },
    mass: { 'kg':1, 'g':0.001, 'mg':0.000001, 'ton':1000, 'lb':0.453592 },
    temp: { 'C':'c', 'F':'f', 'K':'k' } // Special handling
};

function updateUnits(){
    const cat = document.getElementById('conv_cat').value;
    const fromSel = document.getElementById('conv_from');
    const toSel = document.getElementById('conv_to');
    fromSel.innerHTML = ''; toSel.innerHTML = '';
    
    Object.keys(UNITS[cat]).forEach(u => {
        fromSel.add(new Option(u, u));
        toSel.add(new Option(u, u));
    });
}
// Initialize first load
updateUnits();

function runConvert(){
    const cat = document.getElementById('conv_cat').value;
    const val = parseFloat(document.getElementById('conv_val').value);
    const f = document.getElementById('conv_from').value;
    const t = document.getElementById('conv_to').value;
    const resBox = document.getElementById('conv_res');

    if(isNaN(val)) { resBox.innerText = "Input Error"; return; }

    let res = 0;
    if(cat === 'temp'){
        let cVal = val;
        // To Celcius first
        if(f === 'F') cVal = (val - 32) * 5/9;
        if(f === 'K') cVal = val - 273.15;
        // From Celcius to Target
        if(t === 'C') res = cVal;
        if(t === 'F') res = (cVal * 9/5) + 32;
        if(t === 'K') res = cVal + 273.15;
    } else {
        // Linear conversion (Value * BaseFrom / BaseTo)
        const base = val * UNITS[cat][f];
        res = base / UNITS[cat][t];
    }
    
    resBox.innerText = `= ${Number.isInteger(res) ? res : res.toFixed(4)} ${t}`;
}

// 1. POMODORO TIMER
let timerInterval;
let timeLeft = 25 * 60; // 25 menit
let isRunning = false;

function updateTimerDisplay() {
    const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
    const s = (timeLeft % 60).toString().padStart(2, '0');
    document.getElementById('timerDisplay').innerText = `${m}:${s}`;
}

function toggleTimer() {
    const btn = document.getElementById('timerBtn');
    if (!isRunning) {
        isRunning = true;
        btn.innerText = "Pause";
        btn.className = "flex-1 bg-yellow-600 hover:bg-yellow-500 py-2 rounded-lg text-white font-bold transition";
        timerInterval = setInterval(() => {
            if (timeLeft > 0) {
                timeLeft--;
                updateTimerDisplay();
            } else {
                clearInterval(timerInterval);
                isRunning = false;
                btn.innerText = "Selesai!";
                alert("Waktu Habis! Istirahat dulu.");
            }
        }, 1000);
    } else {
        clearInterval(timerInterval);
        isRunning = false;
        btn.innerText = "Resume";
        btn.className = "flex-1 bg-green-600 hover:bg-green-500 py-2 rounded-lg text-white font-bold transition";
    }
}

function resetTimer() {
    clearInterval(timerInterval);
    isRunning = false;
    timeLeft = 25 * 60;
    updateTimerDisplay();
    const btn = document.getElementById('timerBtn');
    btn.innerText = "Start";
    btn.className = "flex-1 bg-red-600 hover:bg-red-500 py-2 rounded-lg text-white font-bold transition";
}

// 2. TODO LIST (Simple) - DENGAN FITUR HAPUS
let todos = [];

function addTodo() {
    const input = document.getElementById('todoInput');
    const val = input.value.trim();
    if (val) {
        todos.push({ text: val, done: false });
        input.value = "";
        renderTodos();
    }
}

function toggleTodo(idx) {
    todos[idx].done = !todos[idx].done;
    renderTodos();
}

// FITUR BARU: Fungsi Menghapus
function deleteTodo(idx) {
    // Hapus 1 item pada index yang dipilih
    todos.splice(idx, 1); 
    renderTodos();
}

function renderTodos() {
    const list = document.getElementById('todoList');
    const count = document.getElementById('todoCount');
    list.innerHTML = "";
    
    let doneCount = 0;
    todos.forEach((t, i) => {
        if(t.done) doneCount++;
        const li = document.createElement('li');
        li.className = "flex items-center gap-2 cursor-pointer hover:bg-white/5 p-2 rounded-lg group transition border-b border-white/5 last:border-0";
        
        // Saat baris diklik, status selesai/belum berubah (Toggle)
        li.onclick = () => toggleTodo(i);
        
        li.innerHTML = `
            <div class="w-5 h-5 border border-slate-500 rounded flex items-center justify-center transition ${t.done ? 'bg-yellow-500 border-yellow-500' : 'hover:border-yellow-500'}">
                ${t.done ? '<i data-lucide="check" class="w-3 h-3 text-black font-bold"></i>' : ''}
            </div>
            
            <span class="${t.done ? 'line-through text-slate-500' : 'text-slate-200'} flex-1 text-sm select-none">${t.text}</span>
            
            <button onclick="deleteTodo(${i}); event.stopPropagation();" class="text-slate-600 hover:text-red-400 p-1 rounded opacity-0 group-hover:opacity-100 transition transform hover:scale-110" title="Hapus">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
            </button>
        `;
        list.appendChild(li);
    });
    
    count.innerText = `${doneCount}/${todos.length} Selesai`;
    
    if(todos.length === 0) {
        list.innerHTML = '<li class="text-slate-500 text-center italic text-xs mt-4 py-4 border border-dashed border-slate-700 rounded-lg">Belum ada target belajar.<br>Ayo tambah satu!</li>';
    }
    
    // Refresh ikon agar tombol hapus terlihat
    lucide.createIcons();
}

// 3. SCRATCHPAD (AUTO-SAVE)
// Memuat catatan tersimpan saat halaman dibuka
const savedNote = localStorage.getItem('rumusPad');
if(savedNote) document.getElementById('scratchpad').value = savedNote;

function savePad() {
    const val = document.getElementById('scratchpad').value;
    localStorage.setItem('rumusPad', val);
    const status = document.getElementById('saveStatus');
    status.innerText = "Saving...";
    setTimeout(() => status.innerText = "Saved", 1000);
}

// --- 1. LOGIKA REGRESI LINEAR ---
function runRegression() {
    const xStr = document.getElementById('reg_x').value.split(',').map(Number);
    const yStr = document.getElementById('reg_y').value.split(',').map(Number);
    
    if (xStr.length !== yStr.length || xStr.some(isNaN)) {
        alert("Pastikan jumlah data X dan Y sama dan berupa angka.");
        return;
    }

    const n = xStr.length;
    const sumX = xStr.reduce((a, b) => a + b, 0);
    const sumY = yStr.reduce((a, b) => a + b, 0);
    const sumXY = xStr.reduce((sum, xi, i) => sum + xi * yStr[i], 0);
    const sumXX = xStr.reduce((sum, xi) => sum + xi * xi, 0);

    const m = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
    const c = (sumY - m * sumX) / n;

    // Generate Line Points
    const xLine = [Math.min(...xStr), Math.max(...xStr)];
    const yLine = xLine.map(x => m * x + c);

    const trace1 = { x: xStr, y: yStr, mode: 'markers', type: 'scatter', name: 'Data', marker: {color: '#60a5fa'} };
    const trace2 = { x: xLine, y: yLine, mode: 'lines', type: 'scatter', name: 'Fit', line: {color: '#f43f5e'} };

    Plotly.newPlot('regPlot', [trace1, trace2], {
        paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 10, l: 30, r: 10, b: 30 },
        xaxis: { color: '#94a3b8' }, yaxis: { color: '#94a3b8' },
        showlegend: false
    });
    
    document.getElementById('regEq').innerText = `y = ${m.toFixed(2)}x + ${c.toFixed(2)}`;
}

// --- 2. LOGIKA BANDUL (CANVAS) ---
let penAnim;
function startPendulum() {
    const canvas = document.getElementById('pendulumCanvas');
    const ctx = canvas.getContext('2d');
    const L_val = parseFloat(document.getElementById('pen_l').value); // Pixel length
    const g_val = parseFloat(document.getElementById('pen_g').value);
    
    // Fisika Sederhana
    const lengthM = L_val / 100; // Asumsi skala
    const period = 2 * Math.PI * Math.sqrt(lengthM / (g_val/10)); // g scaled down visual
    document.getElementById('pen_period').innerText = `T â‰ˆ ${period.toFixed(2)}s`;

    let angle = Math.PI / 4; // 45 derajat start
    let time = 0;
    const origin = { x: canvas.width / 2, y: 0 };
    
    if(penAnim) cancelAnimationFrame(penAnim);

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Hitung posisi
        const omega = Math.sqrt((g_val * 5) / L_val); // Speed factor visual
        const currentAngle = (Math.PI / 4) * Math.cos(omega * time);
        
        const ballX = origin.x + L_val * Math.sin(currentAngle);
        const ballY = origin.y + L_val * Math.cos(currentAngle);

        // Gambar Tali
        ctx.beginPath();
        ctx.moveTo(origin.x, origin.y);
        ctx.lineTo(ballX, ballY);
        ctx.strokeStyle = '#e2e8f0';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Gambar Bandul
        ctx.beginPath();
        ctx.arc(ballX, ballY, 10, 0, Math.PI * 2);
        ctx.fillStyle = '#eab308';
        ctx.fill();
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#eab308';

        time += 0.05;
        penAnim = requestAnimationFrame(animate);
    }
    animate();
}

// --- 3. LOGIKA GRAFIK LISSAJOUS (Gantikan updateRGB) ---
function updateLissajous() {
    const a = parseFloat(document.getElementById('lis_a').value);
    const b = parseFloat(document.getElementById('lis_b').value);
    const d = parseFloat(document.getElementById('lis_d').value);

    // Update angka display kecil di bawah slider
    document.getElementById('val_a').innerText = a;
    document.getElementById('val_b').innerText = b;
    document.getElementById('val_d').innerText = d.toFixed(2);

    let xArr = [], yArr = [];
    // Generate data titik (t dari 0 sampai 2*PI)
    // Kita pakai loop agak banyak biar grafiknya halus
    for (let t = 0; t <= 2 * Math.PI; t += 0.01) {
        xArr.push(Math.sin(a * t + d));
        yArr.push(Math.sin(b * t));
    }

    const trace = {
        x: xArr,
        y: yArr,
        mode: 'lines',
        line: { color: '#2dd4bf', width: 3, shape: 'spline' }, // Teal color
        hoverinfo: 'none'
    };

    const layout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 10, l: 20, r: 10, b: 20 },
        xaxis: { 
            range: [-1.2, 1.2], 
            showgrid: false, 
            zeroline: false, 
            showticklabels: false 
        },
        yaxis: { 
            range: [-1.2, 1.2], 
            showgrid: false, 
            zeroline: false, 
            showticklabels: false,
            scaleanchor: "x", // Agar proporsional (lingkaran tidak jadi lonjong)
            scaleratio: 1 
        },
        showlegend: false
    };

    Plotly.newPlot('lissajousPlot', [trace], layout, {displayModeBar: false, staticPlot: true});
}

// Jalankan sekali saat loading agar grafik muncul
setTimeout(updateLissajous, 1000);

// --- SYSTEM STATUS BAR LOGIC ---

// 1. REAL TIME CLOCK
function updateSystemTime() {
    const d = new Date();
    const timeStr = d.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
    document.getElementById('realTime').innerText = timeStr;
}
setInterval(updateSystemTime, 1000);
updateSystemTime(); // Init

// 2. BATTERY STATUS
function initBattery() {
    const batLevel = document.getElementById('batLevel');
    const batIcon = document.getElementById('batIcon');
    const batBolt = document.getElementById('batBolt');

    if ('getBattery' in navigator) {
        navigator.getBattery().then(function(battery) {
            function updateBatteryUI() {
                const level = Math.round(battery.level * 100);
                batLevel.innerText = level + "%";
                
                // Charging Indicator
                if (battery.charging) {
                    batBolt.classList.remove('hidden');
                    batLevel.classList.add('text-yellow-400');
                    batIcon.classList.add('text-yellow-400');
                } else {
                    batBolt.classList.add('hidden');
                    
                    // Color logic based on level
                    if(level > 20) {
                        batLevel.className = "text-[10px] font-bold font-mono text-green-400 transition";
                        batIcon.className = "w-3.5 h-3.5 text-green-400 transition";
                    } else {
                        batLevel.className = "text-[10px] font-bold font-mono text-red-500 transition animate-pulse";
                        batIcon.className = "w-3.5 h-3.5 text-red-500 transition";
                    }
                }
            }
            
            updateBatteryUI();
            battery.addEventListener('levelchange', updateBatteryUI);
            battery.addEventListener('chargingchange', updateBatteryUI);
        });
    } else {
        // Fallback jika browser tidak support API Baterai
        batLevel.innerText = "N/A";
    }
}
initBattery();

// 3. NETWORK / WIFI STATUS
function updateNetworkStatus() {
    const netEl = document.getElementById('netStatus');
    // Cek status online/offline browser
    if(navigator.onLine) {
        // Coba ambil info koneksi (Chrome/Edge only)
        const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        if (conn) {
            // Tampilkan 4G/3G atau kecepatan
            const type = conn.effectiveType ? conn.effectiveType.toUpperCase() : 'WIFI';
            netEl.innerText = type; 
        } else {
            netEl.innerText = "ONLINE";
        }
        netEl.classList.remove('text-red-500');
        netEl.classList.add('text-blue-300');
    } else {
        netEl.innerText = "OFFLINE";
        netEl.classList.remove('text-blue-300');
        netEl.classList.add('text-red-500');
    }
}
window.addEventListener('online', updateNetworkStatus);
window.addEventListener('offline', updateNetworkStatus);
updateNetworkStatus(); // Init

window.addEventListener('load', () => {
    const loader = document.getElementById('appLoader');
    const bars = document.querySelectorAll('.bar-3d');
    const text = document.getElementById('loaderText');

    // 1. Update Teks Status
    setTimeout(() => text.innerText = "LOADING MODULES...", 1000);
    setTimeout(() => text.innerText = "READY TO LAUNCH.", 2000);

    // 2. Mulai Efek Gelombang Turun (Wave Down) setelah 2.5 detik
    setTimeout(() => {
        // Hentikan animasi bouncing (float)
        bars.forEach(bar => {
            bar.classList.remove('animate-float');
        });

        // Tambahkan animasi turun (wave-out) dengan delay berurutan
        bars.forEach((bar, index) => {
            // Kita set style animation manual agar menimpa delay sebelumnya
            bar.style.animation = `waveOut 0.8s cubic-bezier(0.5, 0, 0, 1) forwards ${index * 0.1}s`;
        });

        // Fade out text & background sedikit lebih lambat dari bar terakhir
        text.style.opacity = '0';
        loader.style.transition = "opacity 0.8s ease 0.6s"; // Delay transisi bg
        loader.style.opacity = '0';

        // 3. Hapus elemen dari DOM setelah animasi selesai
        setTimeout(() => {
            loader.style.display = 'none';
        }, 1500); // Waktu total animasi wave selesai
    }, 2500);
});
    </script>
</body>
</html>
